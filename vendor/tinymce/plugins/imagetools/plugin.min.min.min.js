!function(){var l={},o=function(g){for(var c=l[g],h=c.deps,d=c.defn,b=h.length,f=new Array(b),k=0;k<b;++k){f[k]=m(h[k])}var j=d.apply(null,f);if(void 0===j){throw"module ["+g+"] returned undefined"}c.instance=j},e=function(b,c,d){if("string"!=typeof b){throw"module id must be a string"}if(void 0===c){throw"no dependencies for "+b}if(void 0===d){throw"no definition function for "+b}l[b]={deps:c,defn:d,instance:void 0}},m=function(c){var b=l[c];if(void 0===b){throw"module ["+c+"] was undefined"}return void 0===b.instance&&o(c),b.instance},p=function(b,d){for(var f=b.length,c=new Array(f),g=0;g<f;++g){c.push(m(b[g]))}d.apply(null,d)},i={};i.bolt={module:{api:{define:e,require:p,demand:m}}};var a=e,n=function(c,b){a(c,[],function(){return b})};n("1",tinymce.PluginManager),n("2",tinymce.Env),n("3",tinymce.util.Promise),n("4",tinymce.util.URI),n("5",tinymce.util.Tools),n("6",tinymce.util.Delay),a("m",[],function(){function d(g,h){return f(document.createElement("canvas"),g,h)}function c(g){return g.getContext("2d")}function b(g){var h=null;try{h=g.getContext("webgl")||g.getContext("experimental-webgl")}catch(g){}return h||(h=null),h}function f(h,j,g){return h.width=j,h.height=g,h}return{create:d,resize:f,get2dContext:c,get3dContext:b}}),a("n",[],function(){function c(d){return d.naturalWidth||d.width}function b(d){return d.naturalHeight||d.height}return{getWidth:c,getHeight:b}}),a("o",[],function(){function k(t,q){return function(){t.apply(q,arguments)}}function f(q){if("object"!=typeof this){throw new TypeError("Promises must be constructed via new")}if("function"!=typeof q){throw new TypeError("not a function")}this._state=null,this._value=null,this._deferreds=[],c(q,k(g,this),k(r,this))}function b(t){var q=this;return null===this._state?void this._deferreds.push(t):void s(function(){var w=v._state?t.onFulfilled:t.onRejected;if(null===w){return void (v._state?t.resolve:t.reject)(v._value)}var u;try{u=w(v._value)}catch(v){return void t.reject(v)}t.resolve(u)})}function g(t){try{if(t===this){throw new TypeError("A promise cannot be resolved with itself.")}if(t&&("object"==typeof t||"function"==typeof t)){var q=t.then;if("function"==typeof q){return void c(u(q,t),u(g,this),u(r,this))}}this._state=!0,this._value=t,d.call(this)}catch(u){r.call(this,u)}}function r(q){this._state=!1,this._value=q,d.call(this)}function d(){for(var t=0,q=this._deferreds.length;t<q;t++){b.call(this,this._deferreds[t])}this._deferreds=null}function j(t,q,v,u){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof q?q:null,this.resolve=v,this.reject=u}function c(t,q,v){var u=!1;try{t(function(w){u||(u=!0,q(w))},function(w){u||(u=!0,v(w))})}catch(t){if(u){return}u=!0,v(t)}}if(window.Promise){return window.Promise}var s=f.immediateFn||"function"==typeof setImmediate&&setImmediate||function(q){setTimeout(q,1)},h=Array.isArray||function(q){return"[object Array]"===Object.prototype.toString.call(q)};return f.prototype["catch"]=function(q){return this.then(null,q)},f.prototype.then=function(u,t){var q=this;return new f(function(w,v){b.call(q,new j(u,t,w,v))})},f.all=function(){var q=Array.prototype.slice.call(1===arguments.length&&h(arguments[0])?arguments[0]:arguments);return new f(function(t,y){function w(z,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var B=u.then;if("function"==typeof B){return void B.call(u,function(C){w(z,C)},y)}}A[z]=u,0===--x&&t(A)}catch(A){y(A)}}if(0===q.length){return t([])}for(var x=q.length,v=0;v<q.length;v++){w(v,q[v])}})},f.resolve=function(q){return q&&"object"==typeof q&&q.constructor===f?q:new f(function(t){t(q)})},f.reject=function(q){return new f(function(u,t){t(q)})},f.race=function(q){return new f(function(t,u){for(var w=0,v=q.length;w<v;w++){q[w].then(t,u)}})},f}),a("p",[],function(){function c(d){var f=document.createElement("a");return f.href=d,f.pathname}function b(f){var h=c(f).split("."),d=h[h.length-1],g={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"};return d&&(d=d.toLowerCase()),g[d]}return{guessMimeType:b}}),a("e",["o","m","p","n"],function(f,I,s,h){function k(q){return new f(function(w){function v(){q.removeEventListener("load",v),w(q)}q.complete?w(q):q.addEventListener("load",v)})}function u(q){return k(q).then(function(x){var w,v;return v=I.create(h.getWidth(x),h.getHeight(x)),w=I.get2dContext(v),w.drawImage(x,0,0),v})}function K(q){return k(q).then(function(v){var w=v.src;return 0===w.indexOf("blob:")?r(w):0===w.indexOf("data:")?J(w):u(v).then(function(x){return J(x.toDataURL(s.guessMimeType(w)))})})}function t(q){return new f(function(v){function x(){w.removeEventListener("load",x),v(w)}var w=new Image;w.addEventListener("load",x),w.src=URL.createObjectURL(q),w.complete&&x()})}function r(q){return new f(function(w){var v=new XMLHttpRequest;v.open("GET",q,!0),v.responseType="blob",v.onload=function(){200==this.status&&w(this.response)},v.send()})}function J(q){return new f(function(z){var w,y,B,x,v,A;if(q=q.split(","),x=/data:([^;]+)/.exec(q[0]),x&&(v=x[1]),w=atob(q[1]),window.WebKitBlobBuilder){for(A=new WebKitBlobBuilder,y=new ArrayBuffer(w.length),B=0;B<y.length;B++){y[B]=w.charCodeAt(B)}return A.append(y),void z(A.getBlob(v))}for(y=new Uint8Array(w.length),B=0;B<y.length;B++){y[B]=w.charCodeAt(B)}z(new Blob([y],{type:v}))})}function b(q){return 0===q.indexOf("blob:")?r(q):0===q.indexOf("data:")?J(q):null}function d(v,q){return J(v.toDataURL(q))}function g(q){return new f(function(w){var v=new FileReader;v.onloadend=function(){w(v.result)},v.readAsDataURL(q)})}function c(q){return g(q).then(function(v){return v.split(",")[1]})}function j(q){URL.revokeObjectURL(q.src)}return{blobToImage:t,imageToBlob:K,blobToDataUri:g,blobToBase64:c,imageToCanvas:u,canvasToBlob:d,revokeImageUrl:j,uriToBlob:b}}),a("q",[],function(){function s(w,v,q){return w=parseFloat(w),w>q?w=q:w<v&&(w=v),w}function c(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function d(y,B){var v,z,x,w,q=[],A=new Array(10);for(v=0;v<5;v++){for(z=0;z<5;z++){q[z]=B[z+5*v]}for(z=0;z<5;z++){for(w=0,x=0;x<5;x++){w+=y[z+5*x]*q[x]}A[z+5*v]=w}}return A}function j(q,v){return v=s(v,0,1),q.map(function(x,w){return w%6===0?x=1-(1-x)*v:x*=v,s(x,0,1)})}function t(w,v){var q;return v=s(v,-1,1),v*=100,v<0?q=127+v/100*127:(q=v%1,q=0===q?r[v]:r[Math.floor(v)]*(1-q)+r[Math.floor(v)+1]*q,q=127*q+127),d(w,[q/127,0,0,0,0.5*(127-q),0,q/127,0,0,0.5*(127-q),0,0,q/127,0,0.5*(127-q),0,0,0,1,0,0,0,0,0,1])}function g(z,x){var q,w,y,v;return x=s(x,-1,1),q=1+(x>0?3*x:x),w=0.3086,y=0.6094,v=0.082,d(z,[w*(1-q)+q,y*(1-q),v*(1-q),0,0,w*(1-q),y*(1-q)+q,v*(1-q),0,0,w*(1-q),y*(1-q),v*(1-q)+q,0,0,0,0,0,1,0,0,0,0,0,1])}function h(y,w){var q,v,A,x,z;return w=s(w,-180,180)/180*Math.PI,q=Math.cos(w),v=Math.sin(w),A=0.213,x=0.715,z=0.072,d(y,[A+q*(1-A)+v*-A,x+q*-x+v*-x,z+q*-z+v*(1-z),0,0,A+q*-A+0.143*v,x+q*(1-x)+0.14*v,z+q*-z+v*-0.283,0,0,A+q*-A+v*-(1-A),x+q*-x+v*x,z+q*(1-z)+v*z,0,0,0,0,0,1,0,0,0,0,0,1])}function b(q,v){return v=s(255*v,-255,255),d(q,[1,0,0,0,v,0,1,0,0,v,0,0,1,0,v,0,0,0,1,0,0,0,0,0,1])}function u(w,v,q,x){return v=s(v,0,2),q=s(q,0,2),x=s(x,0,2),d(w,[v,0,0,0,0,0,q,0,0,0,0,0,x,0,0,0,0,0,1,0,0,0,0,0,1])}function f(v,q){return q=s(q,0,1),d(v,j([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],q))}function k(v,q){return q=s(q,0,1),d(v,j([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],q))}var r=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:c,adjust:j,multiply:d,adjustContrast:t,adjustBrightness:b,adjustSaturation:g,adjustHue:h,adjustColors:u,adjustSepia:f,adjustGrayscale:k}}),a("c",["m","n","e","q"],function(r,d,c,h){function s(u,q){return c.blobToImage(u).then(function(v){function y(aB,am){var E,aj,A,N,ax,al=aB.data,C=am[0],ao=am[1],az=am[2],aA=am[3],aC=am[4],S=am[5],aE=am[6],D=am[7],aD=am[8],ap=am[9],at=am[10],ay=am[11],ak=am[12],ar=am[13],aq=am[14],an=am[15],au=am[16],aw=am[17],av=am[18],B=am[19];for(ax=0;ax<al.length;ax+=4){E=al[ax],aj=al[ax+1],A=al[ax+2],N=al[ax+3],al[ax]=E*C+aj*ao+A*az+N*aA+aC,al[ax+1]=E*S+aj*aE+A*D+N*aD+ap,al[ax+2]=E*at+aj*ay+A*ak+N*ar+aq,al[ax+3]=E*an+aj*au+A*aw+N*av+B}return aB}var z,x=r.create(d.getWidth(v),d.getHeight(v)),w=r.get2dContext(x);return w.drawImage(v,0,0),k(v),z=y(w.getImageData(0,0,x.width,x.height),q),w.putImageData(z,0,0),c.canvasToBlob(x)})}function f(u,q){return c.blobToImage(u).then(function(y){function x(E,am,ag){function aj(I,G,H){return I>H?I=H:I<G&&(I=G),I}var ad,ah,aq,al,ae,an,C,D,F,ai,ac,af,ab,ao,ap,B,ak;for(aq=Math.round(Math.sqrt(ag.length)),al=Math.floor(aq/2),ad=E.data,ah=am.data,B=E.width,ak=E.height,an=0;an<ak;an++){for(ae=0;ae<B;ae++){for(C=D=F=0,ac=0;ac<aq;ac++){for(ai=0;ai<aq;ai++){af=aj(ae+ai-al,0,B-1),ab=aj(an+ac-al,0,ak-1),ao=4*(ab*B+af),ap=ag[ac*aq+ai],C+=ad[ao]*ap,D+=ad[ao+1]*ap,F+=ad[ao+2]*ap}}ao=4*(an*B+ae),ah[ao]=aj(C,0,255),ah[ao+1]=aj(D,0,255),ah[ao+2]=aj(F,0,255)}}return am}var A,z,w=r.create(d.getWidth(y),d.getHeight(y)),v=r.get2dContext(w);return v.drawImage(y,0,0),k(y),A=v.getImageData(0,0,w.width,w.height),z=v.getImageData(0,0,w.width,w.height),z=x(A,z,q),v.putImageData(z,0,0),c.canvasToBlob(w)})}function j(q){return function(v,u){return c.blobToImage(v).then(function(w){function B(D,E){var H,F=D.data;for(H=0;H<F.length;H+=4){F[H]=E[F[H]],F[H+1]=E[F[H+1]],F[H+2]=E[F[H+2]]}return D}var A,C,y=r.create(d.getWidth(w),d.getHeight(w)),x=r.get2dContext(y),z=new Array(256);for(C=0;C<z.length;C++){z[C]=q(C,u)}return x.drawImage(w,0,0),k(w),A=B(x.getImageData(0,0,y.width,y.height),z),x.putImageData(A,0,0),c.canvasToBlob(y)})}}function b(q){return function(v,u){return s(v,q(h.identity(),u))}}function t(q){return function(u){return s(u,q)}}function g(q){return function(u){return f(u,q)}}var k=c.revokeImageUrl;return{invert:t([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:b(h.adjustBrightness),hue:b(h.adjustHue),saturate:b(h.adjustSaturation),contrast:b(h.adjustContrast),grayscale:b(h.adjustGrayscale),sepia:b(h.adjustSepia),colorize:function(v,u,w,q){return s(v,h.adjustColors(h.identity(),u,w,q))},sharpen:g([0,-1,0,-1,5,-1,0,-1,0]),emboss:g([-2,-1,0,-1,1,1,0,1,2]),gamma:j(function(u,q){return 255*Math.pow(u/255,1-q)}),exposure:j(function(u,q){return 255*(1-Math.exp(-(u/255)*q))}),colorFilter:s,convoluteFilter:f}}),a("r",["o","e","m","n"],function(h,d,f,b){function c(j,t,s){var B=b.getWidth(j),q=b.getHeight(j),k=t/B,u=s/q,C=!1;(k<0.5||k>2)&&(k=k<0.5?0.5:2,C=!0),(u<0.5||u>2)&&(u=u<0.5?0.5:2,C=!0);var D=g(j,k,u);return C?D.then(function(r){return c(r,t,s)}):D}function g(q,k,j){return new h(function(s){var B=b.getWidth(q),u=b.getHeight(q),A=Math.floor(B*k),z=Math.floor(u*j),C=f.create(A,z),r=f.get2dContext(C);r.drawImage(q,0,0,B,u,0,0,A,z),s(C)})}return{scale:c}}),a("d",["e","m","n","r"],function(k,f,b,g){function r(t,q){return k.blobToImage(t).then(function(x){var w=f.create(b.getWidth(x),b.getHeight(x)),y=f.get2dContext(w),u=0,v=0;return q=q<0?360+q:q,90!=q&&270!=q||f.resize(w,w.height,w.width),90!=q&&180!=q||(u=w.width),270!=q&&180!=q||(v=w.height),y.translate(u,v),y.rotate(q*Math.PI/180),y.drawImage(x,0,0),s(x),k.canvasToBlob(w,t.type)})}function d(t,q){return k.blobToImage(t).then(function(u){var w=f.create(b.getWidth(u),b.getHeight(u)),v=f.get2dContext(w);return"v"==q?(v.scale(1,-1),v.drawImage(u,0,-w.height)):(v.scale(-1,1),v.drawImage(u,-w.width,0)),s(u),k.canvasToBlob(w)})}function j(v,x,q,w,y){return k.blobToImage(v).then(function(z){var u=f.create(w,y),t=f.get2dContext(u);return t.drawImage(z,-x,-q),s(z),k.canvasToBlob(u)})}function c(u,t,q){return k.blobToImage(u).then(function(w){var v;return v=g.scale(w,t,q).then(function(x){return k.canvasToBlob(x,u.type)}).then(h(w))["catch"](h(w))})}var s=k.revokeImageUrl,h=function(q){return function(t){return s(q),t}};return{rotate:r,flip:d,crop:j,resize:c}}),a("7",["c","d"],function(g,k){var O=function(q){return g.invert(q)},f=function(q){return g.sharpen(q)},u=function(q){return g.emboss(q)},Q=function(q,w){return g.gamma(q,w)},b=function(q,w){return g.exposure(q,w)},h=function(y,q,x,w){return g.colorize(y,q,x,w)},v=function(q,w){return g.brightness(q,w)},s=function(q,w){return g.hue(q,w)},c=function(q,w){return g.saturate(q,w)},d=function(q,w){return g.contrast(q,w)},j=function(q,w){return g.grayscale(q,w)},R=function(q,w){return g.sepia(q,w)},t=function(q,w){return k.flip(q,w)},N=function(q,y,x,w,z){return k.crop(q,y,x,w,z)},r=function(x,w,q){return k.resize(x,w,q)},P=function(q,w){return k.rotate(q,w)};return{invert:O,sharpen:f,emboss:u,brightness:v,hue:s,saturate:c,contrast:d,grayscale:j,sepia:R,colorize:h,gamma:Q,exposure:b,flip:t,crop:N,resize:r,rotate:P}}),a("8",["e"],function(g){var d=function(h){return g.blobToImage(h)},f=function(h){return g.imageToBlob(h)},b=function(h){return g.blobToDataUri(h)},c=function(h){return g.blobToBase64(h)};return{blobToImage:d,imageToBlob:f,blobToDataUri:b,blobToBase64:c}}),n("f",tinymce.dom.DOMUtils),n("g",tinymce.ui.Factory),n("h",tinymce.ui.Form),n("i",tinymce.ui.Container),n("s",tinymce.ui.Control),n("t",tinymce.ui.DragHelper),n("u",tinymce.geom.Rect),n("w",tinymce.dom.DomQuery),n("x",tinymce.util.Observable),n("y",tinymce.util.VK),a("v",["w","t","u","5","x","y"],function(g,j,d,h,b,f){var c=0;return function(V,E,Y,s,u){function v(r,t){return{x:t.x+r.x,y:t.y+r.y,w:t.w,h:t.h}}function R(r,t){return{x:t.x-r.x,y:t.y-r.y,w:t.w,h:t.h}}function x(){return R(Y,V)}function N(H,t,G,r){var F,z,D,A,B;F=t.x,z=t.y,D=t.w,A=t.h,F+=G*H.deltaX,z+=r*H.deltaY,D+=G*H.deltaW,A+=r*H.deltaH,D<20&&(D=20),A<20&&(A=20),B=V=d.clamp({x:F,y:z,w:D,h:A},Y,"move"==H.name),B=R(Y,B),aa.fire("updateRect",{rect:B}),W(B)}function w(){function r(t){var z;return new j(ab,{document:s.ownerDocument,handle:ab+"-"+t.name,start:function(){z=V},drag:function(A){N(t,z,A.deltaX,A.deltaY)}})}g('<div id="'+ab+'" class="'+ad+'croprect-container" role="grid" aria-dropeffect="execute">').appendTo(s),h.each(C,function(t){g("#"+ab,s).append('<div id="'+ab+"-"+t+'"class="'+ad+'croprect-block" style="display: none" data-mce-bogus="all">')}),h.each(k,function(t){g("#"+ab,s).append('<div id="'+ab+"-"+t.name+'" class="'+ad+"croprect-handle "+ad+"croprect-handle-"+t.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+t.label+'" aria-grabbed="false">')}),ac=h.map(k,r),Z(V),g(s).on("focusin focusout",function(t){g(t.target).attr("aria-grabbed","focus"===t.type)}),g(s).on("keydown",function(A){function t(D,H,F,G,B){D.stopPropagation(),D.preventDefault(),N(z,F,G,B)}var z;switch(h.each(k,function(B){if(A.target.id==ab+"-"+B.name){return z=B,!1}}),A.keyCode){case f.LEFT:t(A,z,V,-10,0);break;case f.RIGHT:t(A,z,V,10,0);break;case f.UP:t(A,z,V,0,-10);break;case f.DOWN:t(A,z,V,0,10);break;case f.ENTER:case f.SPACEBAR:A.preventDefault(),u()}})}function y(t){var r;r=h.map(k,function(z){return"#"+ab+"-"+z.name}).concat(h.map(C,function(z){return"#"+ab+"-"+z})).join(","),t?g(r,s).show():g(r,s).hide()}function Z(t){function r(A,z){z.h<0&&(z.h=0),z.w<0&&(z.w=0),g("#"+ab+"-"+A,s).css({left:z.x,top:z.y,width:z.w,height:z.h})}h.each(k,function(z){g("#"+ab+"-"+z.name,s).css({left:t.w*z.xMul+t.x,top:t.h*z.yMul+t.y})}),r("top",{x:E.x,y:E.y,w:E.w,h:t.y-E.y}),r("right",{x:t.x+t.w,y:t.y,w:E.w-t.x-t.w+E.x,h:t.h}),r("bottom",{x:E.x,y:t.y+t.h,w:E.w,h:E.h-t.y-t.h+E.y}),r("left",{x:E.x,y:t.y,w:t.x-E.x,h:t.h}),r("move",t)}function q(r){V=r,Z(V)}function S(r){E=r,Z(V)}function W(r){q(v(Y,r))}function T(r){Y=r,Z(V)}function X(){h.each(ac,function(r){r.destroy()}),ac=[]}var aa,k,ac,C,ad="mce-",ab=ad+"crid-"+c++;return k=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],C=["top","right","bottom","left"],w(s),aa=h.extend({toggleVisibility:y,setClampRect:T,setRect:q,getInnerRect:x,setInnerRect:W,setViewPortRect:S,destroy:X},b)}}),a("j",["s","t","u","5","3","v"],function(g,j,d,h,b,f){function c(k){return new b(function(r){function q(){k.removeEventListener("load",q),r(k)}k.complete?r(k):k.addEventListener("load",q)})}return g.extend({Defaults:{classes:"imagepanel"},selection:function(k){return arguments.length?(this.state.set("rect",k),this):this.state.get("rect")},imageSize:function(){var k=this.state.get("viewRect");return{w:k.w,h:k.h}},toggleCropRect:function(k){this.state.set("cropEnabled",k)},imageSrc:function(r){var k=this,q=new Image;q.src=r,c(q).then(function(){var u,v,s=k.state.get("viewRect");if(v=k.$el.find("img"),v[0]){v.replaceWith(q)}else{var y=document.createElement("div");y.className="mce-imagepanel-bg",k.getEl().appendChild(y),k.getEl().appendChild(q)}u={x:0,y:0,w:q.naturalWidth,h:q.naturalHeight},k.state.set("viewRect",u),k.state.set("rect",d.inflate(u,-20,-20)),s&&s.w==u.w&&s.h==u.h||k.zoomFit(),k.repaintImage(),k.fire("load")})},zoom:function(k){return arguments.length?(this.state.set("zoom",k),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var E,v,s,q,k,u,r,t=this;r=10,E=t.$el.find("img"),v=t.getEl().clientWidth,s=t.getEl().clientHeight,q=E[0].naturalWidth,k=E[0].naturalHeight,u=Math.min((v-r)/q,(s-r)/k),u>=1&&(u=1),t.zoom(u)},repaintImage:function(){var r,J,u,H,s,v,k,I,t,K,q;q=this.getEl(),t=this.zoom(),K=this.state.get("rect"),k=this.$el.find("img"),I=this.$el.find(".mce-imagepanel-bg"),s=q.offsetWidth,v=q.offsetHeight,u=k[0].naturalWidth*t,H=k[0].naturalHeight*t,r=Math.max(0,s/2-u/2),J=Math.max(0,v/2-H/2),k.css({left:r,top:J,width:u,height:H}),I.css({left:r,top:J,width:u,height:H}),this.cropRect&&(this.cropRect.setRect({x:K.x*t+r,y:K.y*t+J,w:K.w*t,h:K.h*t}),this.cropRect.setClampRect({x:r,y:J,w:u,h:H}),this.cropRect.setViewPortRect({x:0,y:0,w:s,h:v}))},bindStates:function(){function q(r){k.cropRect=new f(r,k.state.get("viewRect"),k.state.get("viewRect"),k.getEl(),function(){k.fire("crop")}),k.cropRect.on("updateRect",function(u){var s=u.rect,v=k.zoom();s={x:Math.round(s.x/v),y:Math.round(s.y/v),w:Math.round(s.w/v),h:Math.round(s.h/v)},k.state.set("rect",s)}),k.on("remove",k.cropRect.destroy)}var k=this;k.state.on("change:cropEnabled",function(r){k.cropRect.toggleVisibility(r.value),k.repaintImage()}),k.state.on("change:zoom",function(){k.repaintImage()}),k.state.on("change:rect",function(s){var r=s.value;k.cropRect||q(r),k.cropRect.setRect(r)})}})}),a("k",[],function(){return function(){function g(q){var k;return k=f.splice(++c),f.push(q),{state:q,removed:k}}function j(){if(h()){return f[--c]}}function d(){if(b()){return f[++c]}}function h(){return c>0}function b(){return c!=-1&&c<f.length-1}var f=[],c=-1;return{data:f,add:g,undo:j,redo:d,canUndo:h,canRedo:b}}}),a("9",["f","5","3","g","h","i","j","7","8","k"],function(f,I,s,h,k,u,K,t,r,J){function b(q){return{blob:q,url:URL.createObjectURL(q)}}function d(q){q&&URL.revokeObjectURL(q.url)}function g(q){I.each(q,d)}function c(ae,ac,af){function Z(aC){var aE,aB,aD,aA;aE=F.find("#w")[0],aB=F.find("#h")[0],aD=parseInt(aE.value(),10),aA=parseInt(aB.value(),10),F.find("#constrain")[0].checked()&&B&&w&&aD&&aA&&("w"==aC.control.settings.name?(aA=Math.round(aD*ap),aB.value(aA)):(aD=Math.round(aA*ai),aE.value(aD))),B=aD,w=aA}function ad(aA){return Math.round(100*aA)+"%"}function Y(){F.find("#undo").disabled(!q.canUndo()),F.find("#redo").disabled(!q.canRedo()),F.statusbar.find("#save").disabled(!q.canUndo())}function ah(){F.find("#undo").disabled(!0),F.find("#redo").disabled(!0)}function am(aA){aA&&v.imageSrc(aA.url)}function X(aA){return function(){var aB=I.grep(ao,function(aC){return aC.settings.name!=aA});I.each(aB,function(aC){aC.hide()}),aA.show(),aA.focus()}}function z(aA){an=b(aA),am(an)}function ak(aA){ae=b(aA),am(ae),g(q.add(ae).removed),Y()}function aj(){var aA=v.selection();t.crop(ae.blob,aA.x,aA.y,aA.w,aA.h).then(function(aB){ak(aB),V()})}function C(aB){var aA=[].slice.call(arguments,1);return function(){var aC=an||ae;aB.apply(this,[aC.blob].concat(aA)).then(z)}}function O(aB){var aA=[].slice.call(arguments,1);return function(){aB.apply(this,[ae.blob].concat(aA)).then(ak)}}function V(){am(ae),d(an),X(G)(),Y()}function T(){an&&(ak(an.blob),V())}function ab(){var aA=v.zoom();aA<2&&(aA+=0.1),v.zoom(aA)}function U(){var aA=v.zoom();aA>0.1&&(aA-=0.1),v.zoom(aA)}function S(){ae=q.undo(),am(ae),Y()}function x(){ae=q.redo(),am(ae),Y()}function y(){ac(ae.blob),F.close()}function A(aA){return new k({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:aA})}function M(aB,aA){return A([{text:"Back",onclick:V},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show",function(){ah(),aA(ae.blob).then(function(aC){var aD=b(aC);am(aD),d(an),an=aD})})}function N(aC,aE,aD,aF,aB){function aA(aG){aE(ae.blob,aG).then(function(aH){var aI=b(aH);am(aI),d(an),an=aI})}return A([{text:"Back",onclick:V},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(aG){aA(aG.value)},minValue:aF,maxValue:aB,value:aD,previewFilter:ad},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show",function(){this.find("slider").value(aD),ah()})}function Q(aB,aA){function aC(){var aD,aE,aF;aD=F.find("#r")[0].value(),aE=F.find("#g")[0].value(),aF=F.find("#b")[0].value(),aA(ae.blob,aD,aE,aF).then(function(aH){var aG=b(aH);am(aG),d(an),an=aG})}return A([{text:"Back",onclick:V},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:aC,previewFilter:ad},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:aC,previewFilter:ad},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:aC,previewFilter:ad},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show",function(){F.find("#r,#g,#b").value(1),ah()})}function P(aA){aA.control.value()===!0&&(ap=w/B,ai=B/w)}var F,G,D,an,ar,au,at,v,ag,aa,ax,aw,L,E,H,R,ay,W,av,az,al,aq,ao,B,w,ap,ai,q=new J;ar=A([{text:"Back",onclick:V},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aj}]).hide().on("show hide",function(aA){v.toggleCropRect("show"==aA.type)}).on("show",ah),au=A([{text:"Back",onclick:V},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:Z},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:Z},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:P},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(aC){var aA=parseInt(F.find("#w").value(),10),aB=parseInt(F.find("#h").value(),10);aC.preventDefault(),O(t.resize,aA,aB)(),V()}).on("show",ah),at=A([{text:"Back",onclick:V},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:C(t.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:C(t.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:C(t.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:C(t.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show",ah),ax=M("Invert",t.invert),av=M("Sharpen",t.sharpen),az=M("Emboss",t.emboss),aw=N("Brightness",t.brightness,0,-1,1),L=N("Hue",t.hue,180,0,360),E=N("Saturate",t.saturate,0,-1,1),H=N("Contrast",t.contrast,0,-1,1),R=N("Grayscale",t.grayscale,0,0,1),ay=N("Sepia",t.sepia,0,0,1),W=Q("Colorize",t.colorize),al=N("Gamma",t.gamma,0,-1,1),aq=N("Exposure",t.exposure,1,0,2),D=A([{text:"Back",onclick:V},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:X(L)},{text:"saturate",icon:"saturate",onclick:X(E)},{text:"sepia",icon:"sepia",onclick:X(ay)},{text:"emboss",icon:"emboss",onclick:X(az)},{text:"exposure",icon:"exposure",onclick:X(aq)},{type:"spacer",flex:1}]).hide(),G=A([{tooltip:"Crop",icon:"crop",onclick:X(ar)},{tooltip:"Resize",icon:"resize2",onclick:X(au)},{tooltip:"Orientation",icon:"orientation",onclick:X(at)},{tooltip:"Brightness",icon:"sun",onclick:X(aw)},{tooltip:"Sharpen",icon:"sharpen",onclick:X(av)},{tooltip:"Contrast",icon:"contrast",onclick:X(H)},{tooltip:"Color levels",icon:"drop",onclick:X(W)},{tooltip:"Gamma",icon:"gamma",onclick:X(al)},{tooltip:"Invert",icon:"invert",onclick:X(ax)}]),v=new K({flex:1,imageSrc:ae.url}),ag=new u({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:S},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:x},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:ab},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:U}]}),aa=new u({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[ag,v]}),ao=[G,ar,au,at,D,ax,aw,L,E,H,R,ay,W,av,az,al,aq],F=h.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(f.DOM.getViewPort().w,800),minHeight:Math.min(f.DOM.getViewPort().h,650),title:"Edit image",items:ao.concat([aa]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:y},{text:"Cancel",onclick:"close"}]}),F.renderTo(document.body).reflow(),F.on("close",function(){af(),g(q.data),q=null,an=null}),q.add(ae),Y(),v.on("load",function(){B=v.imageSize().w,w=v.imageSize().h,ap=w/B,ai=B/w,F.find("#w").value(B),F.find("#h").value(w)}),v.on("crop",aj)}function j(q){return new s(function(w,v){c(b(q),w,v)})}return{edit:j}}),a("a",[],function(){function d(h){function f(k){return/^[0-9\.]+px$/.test(k)}var g,j;return g=h.style.width,j=h.style.height,g||j?f(g)&&f(j)?{w:parseInt(g,10),h:parseInt(j,10)}:null:(g=h.width,j=h.height,g&&j?{w:parseInt(g,10),h:parseInt(j,10)}:null)}function c(h,f){var g,j;f&&(g=h.style.width,j=h.style.height,(g||j)&&(h.style.width=f.w+"px",h.style.height=f.h+"px",h.removeAttribute("data-mce-style")),g=h.width,j=h.height,(g||j)&&(h.setAttribute("width",f.w),h.setAttribute("height",f.h)))}function b(f){return{w:f.naturalWidth,h:f.naturalHeight}}return{getImageSize:d,setImageSize:c,getNaturalImageSize:b}}),a("l",["3","5"],function(g,j){var d=function(k){return null!==k&&void 0!==k},h=function(r,k){var q;return q=k.reduce(function(s,t){return d(s)?s[t]:void 0},r),d(q)?q:null},b=function(q,k){return new g(function(r){var s;s=new XMLHttpRequest,s.onreadystatechange=function(){4===s.readyState&&r({status:s.status,blob:this.response})},s.open("GET",q,!0),j.each(k,function(u,t){s.setRequestHeader(t,u)}),s.responseType="blob",s.send()})},f=function(k){return new g(function(q){var r=new FileReader;r.onload=function(t){var s=t.target;q(s.result)},r.readAsText(k)})},c=function(q){var k;try{k=JSON.parse(q)}catch(q){}return k};return{traverse:h,readBlob:f,requestUrlAsBlob:b,parseJson:c}}),a("b",["3","5","l"],function(r,d,c){function h(q){return c.requestUrlAsBlob(q,{}).then(function(u){return u.status>=400?f(u.status):r.resolve(u.blob)})}var s=function(q){return 400===q||403===q||500===q},f=function(q){return r.reject("ImageProxy HTTP error: "+q)},j=function(q){r.reject("ImageProxy Service error: "+q)},b=function(u,q){return c.readBlob(q).then(function(w){var v=c.parseJson(w),x=c.traverse(v,["error","type"]);return j(x?x:"Invalid JSON")})},t=function(u,q){return s(u)?b(u,q):f(u)},g=function(q,u){return c.requestUrlAsBlob(q,{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":u}).then(function(v){return v.status>=400?t(v.status,v.blob):r.resolve(v.blob)})},k=function(u,q){return q?g(u,q):h(u)};return{getUrl:k}}),a("0",["1","2","3","4","5","6","7","8","9","a","b"],function(s,c,d,j,t,g,h,b,u,f,k){var r=function(x){function w(F){x.notificationManager.open({text:F,type:"error"})}function y(){return x.selection.getNode()}function D(G){var F=G.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return F?x.dom.encode(F[1]):null}function A(){return"imagetools"+ac++}function C(G){var F=G.src;return 0===F.indexOf("data:")||0===F.indexOf("blob:")||new j(F).host===x.documentBaseURI.host}function z(F){return t.inArray(x.settings.imagetools_cors_hosts,new j(F.src).host)!==-1}function T(){return x.settings.api_key||x.settings.imagetools_api_key}function ab(H){var F,G=H.src;return z(H)?k.getUrl(H.src,null):C(H)?b.imageToBlob(H):(G=x.settings.imagetools_proxy,G+=(G.indexOf("?")===-1?"?":"&")+"url="+encodeURIComponent(H.src),F=T(),k.getUrl(G,F))}function v(){var F;return F=x.editorUpload.blobCache.getByUri(y().src),F?F.blob():ab(y())}function N(){L=g.setEditorTimeout(x,function(){x.editorUpload.uploadImagesAuto()},x.settings.images_upload_timeout||30000)}function aa(){clearTimeout(L)}function Z(G,F){return b.blobToDataUri(G).then(function(J){var O,P,I,H,K,M;return M=y(),H=x.editorUpload.blobCache,K=H.getByUri(M.src),I=j.parseDataUri(J).data,O=A(),x.settings.images_reuse_filename&&(P=K?K.filename():D(M.src)),K=H.create(O,G,I,P),H.add(K),x.undoManager.transact(function(){function Q(){x.$(M).off("load",Q),x.nodeChanged(),F?x.editorUpload.uploadImagesAuto():(aa(),N())}x.$(M).on("load",Q),x.$(M).attr({src:K.blobUri()}).removeAttr("data-mce-src")}),K})}function S(F){return function(){return x._scanForImages().then(v).then(F).then(Z,w)}}function ad(F){return function(){return S(function(H){var G=f.getImageSize(y());return G&&f.setImageSize(y(),{w:G.h,h:G.w}),h.rotate(H,F)})()}}function q(F){return function(){return S(function(G){return h.flip(G,F)})()}}function af(){var G=y(),F=f.getNaturalImageSize(G),I=function(J){return new d(function(K){b.blobToImage(J).then(function(M){var O=f.getNaturalImageSize(M);F.w==O.w&&F.h==O.h||f.getImageSize(G)&&f.setImageSize(G,O),URL.revokeObjectURL(M.src),K(J)})})},H=function(J){return u.edit(J).then(I).then(function(K){Z(K,!0)},function(){})};G&&ab(G).then(H,w)}function B(){x.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"}),x.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"}),x.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"}),x.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"}),x.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"}),x.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}function ag(){x.on("NodeChange",function(F){R&&R.src!=F.element.src&&(aa(),x.editorUpload.uploadImagesAuto(),R=void 0),ae(F.element)&&(R=F.element)})}function ae(G){var F=x.dom.is(G,"img:not([data-mce-object],[data-mce-placeholder])");return F&&(C(G)||z(G)||x.settings.imagetools_proxy)}function E(){var F=x.settings.imagetools_toolbar;F||(F="rotateleft rotateright | flipv fliph | crop editimage imageoptions"),x.addContextToolbar(ae,F)}var L,R,ac=0;c.fileApi&&(t.each({mceImageRotateLeft:ad(-90),mceImageRotateRight:ad(90),mceImageFlipVertical:q("v"),mceImageFlipHorizontal:q("h"),mceEditImage:af},function(G,F){x.addCommand(F,G)}),B(),E(),ag())};return s.add("imagetools",r),function(){}}),m("0")()}();