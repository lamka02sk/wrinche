!function(){var h={},d=function(r){for(var x=h[r],q=x.deps,w=x.defn,m=q.length,v=new Array(m),e=0;e<m;++e){v[e]=g(q[e])}var p=w.apply(null,v);if(void 0===p){throw"module ["+r+"] returned undefined"}x.instance=p},k=function(a,i,e){if("string"!=typeof a){throw"module id must be a string"}if(void 0===i){throw"no dependencies for "+a}if(void 0===e){throw"no definition function for "+a}h[a]={deps:i,defn:e,instance:void 0}},g=function(e){var a=h[e];if(void 0===a){throw"module ["+e+"] was undefined"}return void 0===a.instance&&d(e),a.instance},c=function(m,l){for(var q=m.length,a=new Array(q),p=0;p<q;++p){a.push(g(m[p]))}l.apply(null,l)},j={};j.bolt={module:{api:{define:k,require:c,demand:g}}};var b=k,f=function(i,a){b(i,[],function(){return a})};f("1",tinymce.PluginManager),f("2",tinymce.Env),f("3",tinymce.util.Promise),f("4",tinymce.util.URI),f("5",tinymce.util.Tools),f("6",tinymce.util.Delay),b("m",[],function(){function l(o,n){return i(document.createElement("canvas"),o,n)}function a(n){return n.getContext("2d")}function m(o){var n=null;try{n=o.getContext("webgl")||o.getContext("experimental-webgl")}catch(o){}return n||(n=null),n}function i(p,o,q){return p.width=o,p.height=q,p}return{create:l,resize:i,get2dContext:a,get3dContext:m}}),b("n",[],function(){function i(l){return l.naturalWidth||l.width}function a(l){return l.naturalHeight||l.height}return{getWidth:i,getHeight:a}}),b("o",[],function(){function x(i,a){return function(){i.apply(a,arguments)}}function A(a){if("object"!=typeof this){throw new TypeError("Promises must be constructed via new")}if("function"!=typeof a){throw new TypeError("not a function")}this._state=null,this._value=null,this._deferreds=[],B(a,x(m,this),x(w,this))}function q(i){var a=this;return null===this._state?void this._deferreds.push(i):void v(function(){var o=e._state?i.onFulfilled:i.onRejected;if(null===o){return void (e._state?i.resolve:i.reject)(e._value)}var l;try{l=o(e._value)}catch(e){return void i.reject(e)}i.resolve(l)})}function m(a){try{if(a===this){throw new TypeError("A promise cannot be resolved with itself.")}if(a&&("object"==typeof a||"function"==typeof a)){var l=a.then;if("function"==typeof l){return void B(i(l,a),i(m,this),i(w,this))}}this._state=!0,this._value=a,p.call(this)}catch(i){w.call(this,i)}}function w(a){this._state=!1,this._value=a,p.call(this)}function p(){for(var i=0,a=this._deferreds.length;i<a;i++){q.call(this,this._deferreds[i])}this._deferreds=null}function y(l,a,o,i){this.onFulfilled="function"==typeof l?l:null,this.onRejected="function"==typeof a?a:null,this.resolve=o,this.reject=i}function B(l,a,o){var i=!1;try{l(function(n){i||(i=!0,a(n))},function(n){i||(i=!0,o(n))})}catch(l){if(i){return}i=!0,o(l)}}if(window.Promise){return window.Promise}var v=A.immediateFn||"function"==typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},z=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};return A.prototype["catch"]=function(a){return this.then(null,a)},A.prototype.then=function(n,l){var a=this;return new A(function(e,i){q.call(a,new y(n,l,e,i))})},A.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&z(arguments[0])?arguments[0]:arguments);return new A(function(l,C){function s(t,i){try{if(i&&("object"==typeof i||"function"==typeof i)){var n=i.then;if("function"==typeof n){return void n.call(i,function(o){s(t,o)},C)}}r[t]=i,0===--e&&l(r)}catch(r){C(r)}}if(0===a.length){return l([])}for(var e=a.length,u=0;u<a.length;u++){s(u,a[u])}})},A.resolve=function(a){return a&&"object"==typeof a&&a.constructor===A?a:new A(function(e){e(a)})},A.reject=function(a){return new A(function(e,i){i(a)})},A.race=function(a){return new A(function(l,s){for(var o=0,e=a.length;o<e;o++){a[o].then(l,s)}})},A}),b("p",[],function(){function i(m){var l=document.createElement("a");return l.href=m,l.pathname}function a(l){var o=i(l).split("."),m=o[o.length-1],e={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"};return m&&(m=m.toLowerCase()),e[m]}return{guessMimeType:a}}),b("e",["o","m","p","n"],function(B,G,w,m){function y(a){return new B(function(i){function l(){a.removeEventListener("load",l),i(a)}a.complete?i(a):a.addEventListener("load",l)})}function v(a){return y(a).then(function(o){var p,l;return l=G.create(m.getWidth(o),m.getHeight(o)),p=G.get2dContext(l),p.drawImage(o,0,0),l})}function E(a){return y(a).then(function(l){var i=l.src;return 0===i.indexOf("blob:")?x(i):0===i.indexOf("data:")?F(i):v(l).then(function(n){return F(n.toDataURL(w.guessMimeType(i)))})})}function H(a){return new B(function(l){function o(){i.removeEventListener("load",o),l(i)}var i=new Image;i.addEventListener("load",o),i.src=URL.createObjectURL(a),i.complete&&o()})}function x(a){return new B(function(i){var l=new XMLHttpRequest;l.open("GET",a,!0),l.responseType="blob",l.onload=function(){200==this.status&&i(this.response)},l.send()})}function F(a){return new B(function(I){var K,u,p,J,l,t;if(a=a.split(","),J=/data:([^;]+)/.exec(a[0]),J&&(l=J[1]),K=atob(a[1]),window.WebKitBlobBuilder){for(t=new WebKitBlobBuilder,u=new ArrayBuffer(K.length),p=0;p<u.length;p++){u[p]=K.charCodeAt(p)}return t.append(u),void I(t.getBlob(l))}for(u=new Uint8Array(K.length),p=0;p<u.length;p++){u[p]=K.charCodeAt(p)}I(new Blob([u],{type:l}))})}function D(a){return 0===a.indexOf("blob:")?x(a):0===a.indexOf("data:")?F(a):null}function C(i,a){return F(i.toDataURL(a))}function A(a){return new B(function(i){var l=new FileReader;l.onloadend=function(){i(l.result)},l.readAsDataURL(a)})}function q(a){return A(a).then(function(i){return i.split(",")[1]})}function z(a){URL.revokeObjectURL(a.src)}return{blobToImage:H,imageToBlob:E,blobToDataUri:A,blobToBase64:q,imageToCanvas:v,canvasToBlob:C,revokeImageUrl:z,uriToBlob:D}}),b("q",[],function(){function x(i,a,l){return i=parseFloat(i),i>l?i=l:i<a&&(i=a),i}function C(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function q(H,E){var J,G,u,I,l=[],F=new Array(10);for(J=0;J<5;J++){for(G=0;G<5;G++){l[G]=E[G+5*J]}for(G=0;G<5;G++){for(I=0,u=0;u<5;u++){I+=H[G+5*u]*l[u]}F[G+5*J]=I}}return F}function m(a,e){return e=x(e,0,1),a.map(function(i,l){return l%6===0?i=1-(1-i)*e:i*=e,x(i,0,1)})}function w(e,l){var a;return l=x(l,-1,1),l*=100,l<0?a=127+l/100*127:(a=l%1,a=0===a?y[l]:y[Math.floor(l)]*(1-a)+y[Math.floor(l)+1]*a,a=127*a+127),q(e,[a/127,0,0,0,0.5*(127-a),0,a/127,0,0,0.5*(127-a),0,0,a/127,0,0.5*(127-a),0,0,0,1,0,0,0,0,0,1])}function p(n,E){var l,F,e,u;return E=x(E,-1,1),l=1+(E>0?3*E:E),F=0.3086,e=0.6094,u=0.082,q(n,[F*(1-l)+l,e*(1-l),u*(1-l),0,0,F*(1-l),e*(1-l)+l,u*(1-l),0,0,F*(1-l),e*(1-l),u*(1-l)+l,0,0,0,0,0,1,0,0,0,0,0,1])}function A(E,G){var u,H,n,F,e;return G=x(G,-180,180)/180*Math.PI,u=Math.cos(G),H=Math.sin(G),n=0.213,F=0.715,e=0.072,q(E,[n+u*(1-n)+H*-n,F+u*-F+H*-F,e+u*-e+H*(1-e),0,0,n+u*-n+0.143*H,F+u*(1-F)+0.14*H,e+u*-e+H*-0.283,0,0,n+u*-n+H*-(1-n),F+u*-F+H*F,e+u*(1-e)+H*e,0,0,0,0,0,1,0,0,0,0,0,1])}function D(a,e){return e=x(255*e,-255,255),q(a,[1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0,0,0,0,0,1])}function v(e,l,a,n){return l=x(l,0,2),a=x(a,0,2),n=x(n,0,2),q(e,[l,0,0,0,0,0,a,0,0,0,0,0,n,0,0,0,0,0,1,0,0,0,0,0,1])}function B(e,a){return a=x(a,0,1),q(e,m([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],a))}function z(e,a){return a=x(a,0,1),q(e,m([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],a))}var y=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:C,adjust:m,multiply:q,adjustContrast:w,adjustBrightness:D,adjustSaturation:p,adjustHue:A,adjustColors:v,adjustSepia:B,adjustGrayscale:z}}),b("c",["m","n","e","q"],function(x,B,q,m){function w(e,a){return q.blobToImage(e).then(function(u){function D(ad,O){var V,R,Z,U,ah,P=ad.data,X=O[0],L=O[1],af=O[2],ae=O[3],ac=O[4],T=O[5],aa=O[6],W=O[7],ab=O[8],K=O[9],H=O[10],ag=O[11],Q=O[12],I=O[13],J=O[14],M=O[15],G=O[16],ai=O[17],F=O[18],Y=O[19];for(ah=0;ah<P.length;ah+=4){V=P[ah],R=P[ah+1],Z=P[ah+2],U=P[ah+3],P[ah]=V*X+R*L+Z*af+U*ae+ac,P[ah+1]=V*T+R*aa+Z*W+U*ab+K,P[ah+2]=V*H+R*ag+Z*Q+U*I+J,P[ah+3]=V*M+R*G+Z*ai+U*F+Y}return ad}var n,t=x.create(B.getWidth(u),B.getHeight(u)),i=x.get2dContext(t);return i.drawImage(u,0,0),y(u),n=D(i.getImageData(0,0,t.width,t.height),a),i.putImageData(n,0,0),q.canvasToBlob(t)})}function p(e,a){return q.blobToImage(e).then(function(E){function F(W,J,P){function M(o,l,r){return o>r?o=r:o<l&&(o=l),o}var S,O,aa,K,R,I,Y,X,V,N,T,Q,U,H,G,Z,L;for(aa=Math.round(Math.sqrt(P.length)),K=Math.floor(aa/2),S=W.data,O=J.data,Z=W.width,L=W.height,I=0;I<L;I++){for(R=0;R<Z;R++){for(Y=X=V=0,T=0;T<aa;T++){for(N=0;N<aa;N++){Q=M(R+N-K,0,Z-1),U=M(I+T-K,0,L-1),H=4*(U*Z+Q),G=P[T*aa+N],Y+=S[H]*G,X+=S[H+1]*G,V+=S[H+2]*G}}H=4*(I*Z+R),O[H]=M(Y,0,255),O[H+1]=M(X,0,255),O[H+2]=M(V,0,255)}}return J}var n,D,i=x.create(B.getWidth(E),B.getHeight(E)),t=x.get2dContext(i);return t.drawImage(E,0,0),y(E),n=t.getImageData(0,0,i.width,i.height),D=t.getImageData(0,0,i.width,i.height),D=F(n,D,a),t.putImageData(D,0,0),q.canvasToBlob(i)})}function z(a){return function(e,l){return q.blobToImage(e).then(function(t){function o(u,i){var G,s=u.data;for(G=0;G<s.length;G+=4){s[G]=i[s[G]],s[G+1]=i[s[G+1]],s[G+2]=i[s[G+2]]}return u}var D,n,r=x.create(B.getWidth(t),B.getHeight(t)),F=x.get2dContext(r),E=new Array(256);for(n=0;n<E.length;n++){E[n]=a(n,l)}return F.drawImage(t,0,0),y(t),D=o(F.getImageData(0,0,r.width,r.height),E),F.putImageData(D,0,0),q.canvasToBlob(r)})}}function C(a){return function(e,i){return w(e,a(m.identity(),i))}}function v(a){return function(e){return w(e,a)}}function A(a){return function(e){return p(e,a)}}var y=q.revokeImageUrl;return{invert:v([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:C(m.adjustBrightness),hue:C(m.adjustHue),saturate:C(m.adjustSaturation),contrast:C(m.adjustContrast),grayscale:C(m.adjustGrayscale),sepia:C(m.adjustSepia),colorize:function(i,a,r,l){return w(i,m.adjustColors(m.identity(),a,r,l))},sharpen:A([0,-1,0,-1,5,-1,0,-1,0]),emboss:A([-2,-1,0,-1,1,1,0,1,2]),gamma:z(function(i,a){return 255*Math.pow(i/255,1-a)}),exposure:z(function(i,a){return 255*(1-Math.exp(-(i/255)*a))}),colorFilter:w,convoluteFilter:p}}),b("r",["o","e","m","n"],function(p,l,s,m){function a(r,z,i){var x=m.getWidth(r),A=m.getHeight(r),o=z/x,y=i/A,w=!1;(o<0.5||o>2)&&(o=o<0.5?0.5:2,w=!0),(y<0.5||y>2)&&(y=y<0.5?0.5:2,w=!0);var v=q(r,o,y);return w?v.then(function(n){return a(n,z,i)}):v}function q(n,e,r){return new p(function(w){var o=m.getWidth(n),v=m.getHeight(n),i=Math.floor(o*e),t=Math.floor(v*r),y=s.create(i,t),x=s.get2dContext(y);x.drawImage(n,0,0,o,v,0,0,i,t),w(y)})}return{scale:a}}),b("d",["e","m","n","r"],function(x,A,q,m){function w(e,a){return x.blobToImage(e).then(function(r){var i=A.create(q.getWidth(r),q.getHeight(r)),n=A.get2dContext(i),l=0,t=0;return a=a<0?360+a:a,90!=a&&270!=a||A.resize(i,i.height,i.width),90!=a&&180!=a||(l=i.width),270!=a&&180!=a||(t=i.height),n.translate(l,t),n.rotate(a*Math.PI/180),n.drawImage(r,0,0),v(r),x.canvasToBlob(i,e.type)})}function p(e,a){return x.blobToImage(e).then(function(l){var n=A.create(q.getWidth(l),q.getHeight(l)),i=A.get2dContext(n);return"v"==a?(i.scale(1,-1),i.drawImage(l,0,-n.height)):(i.scale(-1,1),i.drawImage(l,-n.width,0)),v(l),x.canvasToBlob(n)})}function y(u,s,l,t,e){return x.blobToImage(u).then(function(o){var i=A.create(t,e),a=A.get2dContext(i);return a.drawImage(o,-s,-l),v(o),x.canvasToBlob(i)})}function B(e,l,a){return x.blobToImage(e).then(function(n){var i;return i=m.scale(n,l,a).then(function(o){return x.canvasToBlob(o,e.type)}).then(z(n))["catch"](z(n))})}var v=x.revokeImageUrl,z=function(a){return function(e){return v(a),e}};return{rotate:w,flip:p,crop:y,resize:B}}),b("7",["c","d"],function(J,x){var C=function(a){return J.invert(a)},z=function(a){return J.sharpen(a)},F=function(a){return J.emboss(a)},B=function(a,e){return J.gamma(a,e)},M=function(a,e){return J.exposure(a,e)},y=function(e,m,l,a){return J.colorize(e,m,l,a)},E=function(a,e){return J.brightness(a,e)},w=function(a,e){return J.hue(a,e)},L=function(a,e){return J.saturate(a,e)},K=function(a,e){return J.contrast(a,e)},I=function(a,e){return J.grayscale(a,e)},A=function(a,e){return J.sepia(a,e)},G=function(a,i){return x.flip(a,i)},D=function(m,s,l,a,p){return x.crop(m,s,l,a,p)},H=function(i,l,a){return x.resize(i,l,a)},q=function(a,i){return x.rotate(a,i)};return{invert:C,sharpen:z,emboss:F,brightness:E,hue:w,saturate:L,contrast:K,grayscale:I,sepia:A,colorize:y,gamma:B,exposure:M,flip:G,crop:D,resize:H,rotate:q}}),b("8",["e"],function(o){var l=function(e){return o.blobToImage(e)},p=function(e){return o.imageToBlob(e)},m=function(e){return o.blobToDataUri(e)},a=function(e){return o.blobToBase64(e)};return{blobToImage:l,imageToBlob:p,blobToDataUri:m,blobToBase64:a}}),f("f",tinymce.dom.DOMUtils),f("g",tinymce.ui.Factory),f("h",tinymce.ui.Form),f("i",tinymce.ui.Container),f("s",tinymce.ui.Control),f("t",tinymce.ui.DragHelper),f("u",tinymce.geom.Rect),f("w",tinymce.dom.DomQuery),f("x",tinymce.util.Observable),f("y",tinymce.util.VK),b("v",["w","t","u","5","x","y"],function(s,p,v,q,m,u){var l=0;return function(D,I,A,P,O){function M(x,w){return{x:w.x+x.x,y:w.y+x.y,w:w.w,h:w.h}}function G(x,w){return{x:w.x-x.x,y:w.y-x.y,w:w.w,h:w.h}}function K(){return G(A,D)}function H(E,T,w,C){var x,S,y,R,N;x=T.x,S=T.y,y=T.w,R=T.h,x+=w*E.deltaX,S+=C*E.deltaY,y+=w*E.deltaW,R+=C*E.deltaH,y<20&&(y=20),R<20&&(R=20),N=D=v.clamp({x:x,y:S,w:y,h:R},A,"move"==E.name),N=G(A,N),n.fire("updateRect",{rect:N}),r(N)}function L(){function w(x){var y;return new p(i,{document:P.ownerDocument,handle:i+"-"+x.name,start:function(){y=D},drag:function(C){H(x,y,C.deltaX,C.deltaY)}})}s('<div id="'+i+'" class="'+a+'croprect-container" role="grid" aria-dropeffect="execute">').appendTo(P),q.each(J,function(x){s("#"+i,P).append('<div id="'+i+"-"+x+'"class="'+a+'croprect-block" style="display: none" data-mce-bogus="all">')}),q.each(U,function(x){s("#"+i,P).append('<div id="'+i+"-"+x.name+'" class="'+a+"croprect-handle "+a+"croprect-handle-"+x.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+x.label+'" aria-grabbed="false">')}),e=q.map(U,w),o(D),s(P).on("focusin focusout",function(x){s(x.target).attr("aria-grabbed","focus"===x.type)}),s(P).on("keydown",function(y){function x(S,N,R,E,T){S.stopPropagation(),S.preventDefault(),H(C,R,E,T)}var C;switch(q.each(U,function(E){if(y.target.id==i+"-"+E.name){return C=E,!1}}),y.keyCode){case u.LEFT:x(y,C,D,-10,0);break;case u.RIGHT:x(y,C,D,10,0);break;case u.UP:x(y,C,D,0,-10);break;case u.DOWN:x(y,C,D,0,10);break;case u.ENTER:case u.SPACEBAR:y.preventDefault(),O()}})}function z(w){var x;x=q.map(U,function(y){return"#"+i+"-"+y.name}).concat(q.map(J,function(y){return"#"+i+"-"+y})).join(","),w?s(x,P).show():s(x,P).hide()}function o(w){function x(y,C){C.h<0&&(C.h=0),C.w<0&&(C.w=0),s("#"+i+"-"+y,P).css({left:C.x,top:C.y,width:C.w,height:C.h})}q.each(U,function(y){s("#"+i+"-"+y.name,P).css({left:w.w*y.xMul+w.x,top:w.h*y.yMul+w.y})}),x("top",{x:I.x,y:I.y,w:I.w,h:w.y-I.y}),x("right",{x:w.x+w.w,y:w.y,w:I.w-w.x-w.w+I.x,h:w.h}),x("bottom",{x:I.x,y:w.y+w.h,w:I.w,h:I.h-w.y-w.h+I.y}),x("left",{x:I.x,y:w.y,w:w.x-I.x,h:w.h}),x("move",w)}function Q(w){D=w,o(D)}function F(w){I=w,o(D)}function r(w){Q(M(A,w))}function t(w){A=w,o(D)}function B(){q.each(e,function(w){w.destroy()}),e=[]}var n,U,e,J,a="mce-",i=a+"crid-"+l++;return U=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],J=["top","right","bottom","left"],L(P),n=q.extend({toggleVisibility:z,setClampRect:t,setRect:Q,getInnerRect:K,setInnerRect:r,setViewPortRect:F,destroy:B},m)}}),b("j",["s","t","u","5","3","v"],function(s,p,v,q,m,u){function l(a){return new m(function(e){function i(){a.removeEventListener("load",i),e(a)}a.complete?e(a):a.addEventListener("load",i)})}return s.extend({Defaults:{classes:"imagepanel"},selection:function(a){return arguments.length?(this.state.set("rect",a),this):this.state.get("rect")},imageSize:function(){var a=this.state.get("viewRect");return{w:a.w,h:a.h}},toggleCropRect:function(a){this.state.set("cropEnabled",a)},imageSrc:function(n){var a=this,i=new Image;i.src=n,l(i).then(function(){var w,t,x=a.state.get("viewRect");if(t=a.$el.find("img"),t[0]){t.replaceWith(i)}else{var r=document.createElement("div");r.className="mce-imagepanel-bg",a.getEl().appendChild(r),a.getEl().appendChild(i)}w={x:0,y:0,w:i.naturalWidth,h:i.naturalHeight},a.state.set("viewRect",w),a.state.set("rect",v.inflate(w,-20,-20)),x&&x.w==w.w&&x.h==w.h||a.zoomFit(),a.repaintImage(),a.fire("load")})},zoom:function(a){return arguments.length?(this.state.set("zoom",a),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var B,y,D,A,x,C,w,z=this;w=10,B=z.$el.find("img"),y=z.getEl().clientWidth,D=z.getEl().clientHeight,A=B[0].naturalWidth,x=B[0].naturalHeight,C=Math.min((y-w)/A,(D-w)/x),C>=1&&(C=1),z.zoom(C)},repaintImage:function(){var B,F,y,w,A,x,D,G,z,E,C;C=this.getEl(),z=this.zoom(),E=this.state.get("rect"),D=this.$el.find("img"),G=this.$el.find(".mce-imagepanel-bg"),A=C.offsetWidth,x=C.offsetHeight,y=D[0].naturalWidth*z,w=D[0].naturalHeight*z,B=Math.max(0,A/2-y/2),F=Math.max(0,x/2-w/2),D.css({left:B,top:F,width:y,height:w}),G.css({left:B,top:F,width:y,height:w}),this.cropRect&&(this.cropRect.setRect({x:E.x*z+B,y:E.y*z+F,w:E.w*z,h:E.h*z}),this.cropRect.setClampRect({x:B,y:F,w:y,h:w}),this.cropRect.setViewPortRect({x:0,y:0,w:A,h:x}))},bindStates:function(){function i(n){a.cropRect=new u(n,a.state.get("viewRect"),a.state.get("viewRect"),a.getEl(),function(){a.fire("crop")}),a.cropRect.on("updateRect",function(t){var w=t.rect,o=a.zoom();w={x:Math.round(w.x/o),y:Math.round(w.y/o),w:Math.round(w.w/o),h:Math.round(w.h/o)},a.state.set("rect",w)}),a.on("remove",a.cropRect.destroy)}var a=this;a.state.on("change:cropEnabled",function(n){a.cropRect.toggleVisibility(n.value),a.repaintImage()}),a.state.on("change:zoom",function(){a.repaintImage()}),a.state.on("change:rect",function(o){var e=o.value;a.cropRect||i(e),a.cropRect.setRect(e)})}})}),b("k",[],function(){return function(){function s(i){var a;return a=u.splice(++l),u.push(i),{state:i,removed:a}}function p(){if(q()){return u[--l]}}function v(){if(m()){return u[++l]}}function q(){return l>0}function m(){return l!=-1&&l<u.length-1}var u=[],l=-1;return{data:u,add:s,undo:p,redo:v,canUndo:q,canRedo:m}}}),b("9",["f","5","3","g","h","i","j","7","8","k"],function(B,G,w,m,y,v,E,H,x,F){function D(a){return{blob:a,url:URL.createObjectURL(a)}}function C(a){a&&URL.revokeObjectURL(a.url)}function A(a){G.each(a,C)}function q(aM,aO,aL){function aR(J){var p,K,I,l;p=an.find("#w")[0],K=an.find("#h")[0],I=parseInt(p.value(),10),l=parseInt(K.value(),10),an.find("#constrain")[0].checked()&&ar&&ax&&I&&l&&("w"==J.control.settings.name?(l=Math.round(I*aB),K.value(l)):(I=Math.round(l*aI),p.value(I))),ar=I,ax=l}function aN(l){return Math.round(100*l)+"%"}function aS(){an.find("#undo").disabled(!az.canUndo()),an.find("#redo").disabled(!az.canRedo()),an.statusbar.find("#save").disabled(!az.canUndo())}function aJ(){an.find("#undo").disabled(!0),an.find("#redo").disabled(!0)}function aE(l){l&&ay.imageSrc(l.url)}function aT(l){return function(){var p=G.grep(aC,function(n){return n.settings.name!=l});G.each(p,function(n){n.hide()}),l.show(),l.focus()}}function au(l){aD=D(l),aE(aD)}function aG(l){aM=D(l),aE(aM),A(az.add(aM).removed),aS()}function aH(){var l=ay.selection();H.crop(aM.blob,l.x,l.y,l.w,l.h).then(function(n){aG(n),aV()})}function aq(n){var l=[].slice.call(arguments,1);return function(){var p=aD||aM;n.apply(this,[p.blob].concat(l)).then(au)}}function ah(n){var l=[].slice.call(arguments,1);return function(){n.apply(this,[aM.blob].concat(l)).then(aG)}}function aV(){aE(aM),C(aD),aT(am)(),aS()}function ab(){aD&&(aG(aD.blob),aV())}function aP(){var l=ay.zoom();l<2&&(l+=0.1),ay.zoom(l)}function aa(){var l=ay.zoom();l>0.1&&(l-=0.1),ay.zoom(l)}function ac(){aM=az.undo(),aE(aM),aS()}function aw(){aM=az.redo(),aE(aM),aS()}function av(){aO(aM.blob),an.close()}function at(l){return new y({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:l})}function aj(n,l){return at([{text:"Back",onclick:aV},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:ab}]).hide().on("show",function(){aJ(),l(aM.blob).then(function(I){var p=D(I);aE(p),C(aD),aD=p})})}function ai(J,p,I,n,K){function l(L){p(aM.blob,L).then(function(N){var M=D(N);aE(M),C(aD),aD=M})}return at([{text:"Back",onclick:aV},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(L){l(L.value)},minValue:n,maxValue:K,value:I,previewFilter:aN},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:ab}]).hide().on("show",function(){this.find("slider").value(I),aJ()})}function af(p,l){function n(){var K,J,I;K=an.find("#r")[0].value(),J=an.find("#g")[0].value(),I=an.find("#b")[0].value(),l(aM.blob,K,J,I).then(function(M){var L=D(M);aE(L),C(aD),aD=L})}return at([{text:"Back",onclick:aV},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:n,previewFilter:aN},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:n,previewFilter:aN},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:n,previewFilter:aN},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:ab}]).hide().on("show",function(){an.find("#r,#g,#b").value(1),aJ()})}function ag(l){l.control.value()===!0&&(aB=ax/ar,aI=ar/ax)}var an,am,ap,aD,u,s,t,ay,aK,aQ,i,o,ak,ao,al,ad,e,aU,r,a,aF,aA,aC,ar,ax,aB,aI,az=new F;u=at([{text:"Back",onclick:aV},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aH}]).hide().on("show hide",function(l){ay.toggleCropRect("show"==l.type)}).on("show",aJ),s=at([{text:"Back",onclick:aV},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:aR},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:aR},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:ag},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(p){var l=parseInt(an.find("#w").value(),10),I=parseInt(an.find("#h").value(),10);p.preventDefault(),ah(H.resize,l,I)(),aV()}).on("show",aJ),t=at([{text:"Back",onclick:aV},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:aq(H.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:aq(H.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:aq(H.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:aq(H.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:ab}]).hide().on("show",aJ),i=aj("Invert",H.invert),r=aj("Sharpen",H.sharpen),a=aj("Emboss",H.emboss),o=ai("Brightness",H.brightness,0,-1,1),ak=ai("Hue",H.hue,180,0,360),ao=ai("Saturate",H.saturate,0,-1,1),al=ai("Contrast",H.contrast,0,-1,1),ad=ai("Grayscale",H.grayscale,0,0,1),e=ai("Sepia",H.sepia,0,0,1),aU=af("Colorize",H.colorize),aF=ai("Gamma",H.gamma,0,-1,1),aA=ai("Exposure",H.exposure,1,0,2),ap=at([{text:"Back",onclick:aV},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:aT(ak)},{text:"saturate",icon:"saturate",onclick:aT(ao)},{text:"sepia",icon:"sepia",onclick:aT(e)},{text:"emboss",icon:"emboss",onclick:aT(a)},{text:"exposure",icon:"exposure",onclick:aT(aA)},{type:"spacer",flex:1}]).hide(),am=at([{tooltip:"Crop",icon:"crop",onclick:aT(u)},{tooltip:"Resize",icon:"resize2",onclick:aT(s)},{tooltip:"Orientation",icon:"orientation",onclick:aT(t)},{tooltip:"Brightness",icon:"sun",onclick:aT(o)},{tooltip:"Sharpen",icon:"sharpen",onclick:aT(r)},{tooltip:"Contrast",icon:"contrast",onclick:aT(al)},{tooltip:"Color levels",icon:"drop",onclick:aT(aU)},{tooltip:"Gamma",icon:"gamma",onclick:aT(aF)},{tooltip:"Invert",icon:"invert",onclick:aT(i)}]),ay=new E({flex:1,imageSrc:aM.url}),aK=new v({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:ac},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:aw},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:aP},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:aa}]}),aQ=new v({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[aK,ay]}),aC=[am,u,s,t,ap,i,o,ak,ao,al,ad,e,aU,r,a,aF,aA],an=m.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(B.DOM.getViewPort().w,800),minHeight:Math.min(B.DOM.getViewPort().h,650),title:"Edit image",items:aC.concat([aQ]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:av},{text:"Cancel",onclick:"close"}]}),an.renderTo(document.body).reflow(),an.on("close",function(){aL(),A(az.data),az=null,aD=null}),az.add(aM),aS(),ay.on("load",function(){ar=ay.imageSize().w,ax=ay.imageSize().h,aB=ax/ar,aI=ar/ax,an.find("#w").value(ar),an.find("#h").value(ax)}),ay.on("crop",aH)}function z(a){return new w(function(e,i){q(D(a),e,i)})}return{edit:z}}),b("a",[],function(){function i(p){function m(n){return/^[0-9\.]+px$/.test(n)}var q,o;return q=p.style.width,o=p.style.height,q||o?m(q)&&m(o)?{w:parseInt(q,10),h:parseInt(o,10)}:null:(q=p.width,o=p.height,q&&o?{w:parseInt(q,10),h:parseInt(o,10)}:null)}function a(p,m){var q,o;m&&(q=p.style.width,o=p.style.height,(q||o)&&(p.style.width=m.w+"px",p.style.height=m.h+"px",p.removeAttribute("data-mce-style")),q=p.width,o=p.height,(q||o)&&(p.setAttribute("width",m.w),p.setAttribute("height",m.h)))}function l(m){return{w:m.naturalWidth,h:m.naturalHeight}}return{getImageSize:i,setImageSize:a,getNaturalImageSize:l}}),b("l",["3","5"],function(s,p){var v=function(a){return null!==a&&void 0!==a},q=function(n,a){var i;return i=a.reduce(function(r,o){return v(r)?r[o]:void 0},n),v(i)?i:null},m=function(e,a){return new s(function(o){var n;n=new XMLHttpRequest,n.onreadystatechange=function(){4===n.readyState&&o({status:n.status,blob:this.response})},n.open("GET",e,!0),p.each(a,function(r,i){n.setRequestHeader(i,r)}),n.responseType="blob",n.send()})},u=function(a){return new s(function(i){var o=new FileReader;o.onload=function(e){var r=e.target;i(r.result)},o.readAsText(a)})},l=function(i){var a;try{a=JSON.parse(i)}catch(i){}return a};return{traverse:q,readBlob:u,requestUrlAsBlob:m,parseJson:l}}),b("b",["3","5","l"],function(x,B,q){function m(a){return q.requestUrlAsBlob(a,{}).then(function(e){return e.status>=400?p(e.status):x.resolve(e.blob)})}var w=function(a){return 400===a||403===a||500===a},p=function(a){return x.reject("ImageProxy HTTP error: "+a)},z=function(a){x.reject("ImageProxy Service error: "+a)},C=function(i,a){return q.readBlob(a).then(function(o){var l=q.parseJson(o),n=q.traverse(l,["error","type"]);return z(n?n:"Invalid JSON")})},v=function(i,a){return w(i)?C(i,a):p(i)},A=function(a,e){return q.requestUrlAsBlob(a,{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":e}).then(function(i){return i.status>=400?v(i.status,i.blob):x.resolve(i.blob)})},y=function(i,a){return a?A(i,a):m(i)};return{getUrl:y}}),b("0",["1","2","3","4","5","6","7","8","9","a","b"],function(x,C,q,m,w,p,A,D,v,B,z){var y=function(V){function W(e){V.notificationManager.open({text:e,type:"error"})}function U(){return V.selection.getNode()}function K(e){var E=e.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return E?V.dom.encode(E[1]):null}function P(){return"imagetools"+o++}function M(e){var E=e.src;return 0===E.indexOf("data:")||0===E.indexOf("blob:")||new m(E).host===V.documentBaseURI.host}function Q(e){return w.inArray(V.settings.imagetools_cors_hosts,new m(e.src).host)!==-1}function u(){return V.settings.api_key||V.settings.imagetools_api_key}function r(e){var L,E=e.src;return Q(e)?z.getUrl(e.src,null):M(e)?D.imageToBlob(e):(E=V.settings.imagetools_proxy,E+=(E.indexOf("?")===-1?"?":"&")+"url="+encodeURIComponent(e.src),L=u(),z.getUrl(E,L))}function X(){var e;return e=V.editorUpload.blobCache.getByUri(U().src),e?e.blob():r(U())}function H(){I=p.setEditorTimeout(V,function(){V.editorUpload.uploadImagesAuto()},V.settings.images_upload_timeout||30000)}function s(){clearTimeout(I)}function t(e,E){return D.blobToDataUri(e).then(function(S){var Z,N,T,L,R,aa;return aa=U(),L=V.editorUpload.blobCache,R=L.getByUri(aa.src),T=m.parseDataUri(S).data,Z=P(),V.settings.images_reuse_filename&&(N=R?R.filename():K(aa.src)),R=L.create(Z,e,T,N),L.add(R),V.undoManager.transact(function(){function ab(){V.$(aa).off("load",ab),V.nodeChanged(),E?V.editorUpload.uploadImagesAuto():(s(),H())}V.$(aa).on("load",ab),V.$(aa).attr({src:R.blobUri()}).removeAttr("data-mce-src")}),R})}function F(e){return function(){return V._scanForImages().then(X).then(e).then(t,W)}}function n(E){return function(){return F(function(e){var L=B.getImageSize(U());return L&&B.setImageSize(U(),{w:L.h,h:L.w}),A.rotate(e,E)})()}}function Y(E){return function(){return F(function(e){return A.flip(e,E)})()}}function i(){var R=U(),L=B.getNaturalImageSize(R),N=function(e){return new q(function(S){D.blobToImage(e).then(function(T){var Z=B.getNaturalImageSize(T);L.w==Z.w&&L.h==Z.h||B.getImageSize(R)&&B.setImageSize(R,Z),URL.revokeObjectURL(T.src),S(e)})})},E=function(S){return v.edit(S).then(N).then(function(T){t(T,!0)},function(){})};R&&r(R).then(E,W)}function O(){V.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"}),V.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"}),V.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"}),V.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"}),V.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"}),V.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}function a(){V.on("NodeChange",function(e){G&&G.src!=e.element.src&&(s(),V.editorUpload.uploadImagesAuto(),G=void 0),l(e.element)&&(G=e.element)})}function l(e){var E=V.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])");return E&&(M(e)||Q(e)||V.settings.imagetools_proxy)}function J(){var e=V.settings.imagetools_toolbar;e||(e="rotateleft rotateright | flipv fliph | crop editimage imageoptions"),V.addContextToolbar(l,e)}var I,G,o=0;C.fileApi&&(w.each({mceImageRotateLeft:n(-90),mceImageRotateRight:n(90),mceImageFlipVertical:Y("v"),mceImageFlipHorizontal:Y("h"),mceEditImage:i},function(e,E){V.addCommand(E,e)}),O(),J(),a())};return x.add("imagetools",y),function(){}}),g("0")()}();