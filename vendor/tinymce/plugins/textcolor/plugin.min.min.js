tinymce.PluginManager.add("textcolor",function(h){function m(a){var e;return h.dom.getParents(h.selection.getStart(),function(l){var i;(i=l.style["forecolor"==a?"color":"background-color"])&&(e=i)}),e}function d(e){var o,l,a=[];for(l=["000000","Black","993300","Burnt orange","333300","Dark olive","003300","Dark green","003366","Dark azure","000080","Navy Blue","333399","Indigo","333333","Very dark gray","800000","Maroon","FF6600","Orange","808000","Olive","008000","Green","008080","Teal","0000FF","Blue","666699","Grayish blue","808080","Gray","FF0000","Red","FF9900","Amber","99CC00","Yellow green","339966","Sea green","33CCCC","Turquoise","3366FF","Royal blue","800080","Purple","999999","Medium gray","FF00FF","Magenta","FFCC00","Gold","FFFF00","Yellow","00FF00","Lime","00FFFF","Aqua","00CCFF","Sky blue","993366","Red violet","FFFFFF","White","FF99CC","Pink","FFCC99","Peach","FFFF99","Light yellow","CCFFCC","Pale green","CCFFFF","Pale cyan","99CCFF","Light sky blue","CC99FF","Plum"],l=h.settings.textcolor_map||l,l=h.settings[e+"_map"]||l,o=0;o<l.length;o+=2){a.push({text:l[o+1],color:"#"+l[o]})}return a}function b(){function A(i,a){var o="transparent"==i;return'<td class="mce-grid-cell'+(o?" mce-colorbtn-trans":"")+'"><div id="'+v+"-"+q+++'" data-mce-color="'+(i?i:"")+'" role="option" tabIndex="-1" style="'+(i?"background-color: "+i:"")+'" title="'+tinymce.translate(a)+'">'+(o?"&#215;":"")+"</div></td>"}var e,u,n,z,B,y,x,w,l=this,v=l._id,q=0;for(w=l.settings.origin,e=d(w),e.push({text:tinymce.translate("No color"),color:"transparent"}),n='<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>',z=e.length-1,y=0;y<k[w];y++){for(n+="<tr>",B=0;B<f[w];B++){x=y*f[w]+B,x>z?n+="<td></td>":(u=e[x],n+=A(u.color,u.text))}n+="</tr>"}if(h.settings.color_picker_callback){for(n+='<tr><td colspan="'+f[w]+'" class="mce-custom-color-btn"><div id="'+v+'-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="'+v+'-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">'+tinymce.translate("Custom...")+"</button></div></td></tr>",n+="<tr>",B=0;B<f[w];B++){n+=A("","Custom color")}n+="</tr>"}return n+="</tbody></table>"}function g(a,e){h.undoManager.transact(function(){h.focus(),h.formatter.apply(a,{value:e}),h.nodeChanged()})}function c(a){h.undoManager.transact(function(){h.focus(),h.formatter.remove(a,{value:null},null,!0),h.nodeChanged()})}function j(v){function o(a){q.hidePanel(),q.color(a),g(q.settings.format,a)}function e(){q.hidePanel(),q.resetColor(),c(q.settings.format)}function l(n,a){n.style.background=a,n.setAttribute("data-mce-color",a)}var i,t,q=this.parent();t=q.settings.origin,tinymce.DOM.getParent(v.target,".mce-custom-color-btn")&&(q.hidePanel(),h.settings.color_picker_callback.call(h,function(s){var r,w,a,u=q.panel.getEl().getElementsByTagName("table")[0];for(r=tinymce.map(u.rows[u.rows.length-1].childNodes,function(n){return n.firstChild}),a=0;a<r.length&&(w=r[a],w.getAttribute("data-mce-color"));a++){}if(a==f[t]){for(a=0;a<f[t]-1;a++){l(r[a],r[a+1].getAttribute("data-mce-color"))}}l(w,s),o(s)},m(q.settings.format))),i=v.target.getAttribute("data-mce-color"),i?(this.lastId&&document.getElementById(this.lastId).setAttribute("aria-selected",!1),v.target.setAttribute("aria-selected",!0),this.lastId=v.target.id,"transparent"==i?e():o(i)):null!==i&&q.hidePanel()}function p(){var a=this;a._color?g(a.settings.format,a._color):c(a.settings.format)}var f,k;k={forecolor:h.settings.forecolor_rows||h.settings.textcolor_rows||5,backcolor:h.settings.backcolor_rows||h.settings.textcolor_rows||5},f={forecolor:h.settings.forecolor_cols||h.settings.textcolor_cols||8,backcolor:h.settings.backcolor_cols||h.settings.textcolor_cols||8},h.addButton("forecolor",{type:"colorbutton",tooltip:"Text color",format:"forecolor",panel:{origin:"forecolor",role:"application",ariaRemember:!0,html:b,onclick:j},onclick:p}),h.addButton("backcolor",{type:"colorbutton",tooltip:"Background color",format:"hilitecolor",panel:{origin:"backcolor",role:"application",ariaRemember:!0,html:b,onclick:j},onclick:p})});