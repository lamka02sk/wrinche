tinymce.PluginManager.add("textpattern",function(n){function e(){return i&&(q.sort(function(c,b){return c.start.length>b.start.length?-1:c.start.length<b.start.length?1:0}),i=!1),q}function r(d){for(var c=e(),b=0;b<c.length;b++){if(0===d.indexOf(c[b].start)&&(!c[b].end||d.lastIndexOf(c[b].end)==d.length-c[b].end.length)){return c[b]}}}function t(f,c,g){var h,d,b;for(h=e(),b=0;b<h.length;b++){if(d=h[b],d.end&&f.substr(c-d.end.length-g,d.end.length)==d.end){return d}}}function o(f){function F(){c=c.splitText(m),c.splitText(g-m-E),c.deleteData(0,k.start.length),c.deleteData(c.data.length-k.end.length,k.end.length)}var j,h,b,c,g,m,p,u,k,E,d;if(j=n.selection,h=n.dom,j.isCollapsed()&&(b=j.getRng(!0),c=b.startContainer,g=b.startOffset,p=c.data,E=f?1:0,3==c.nodeType&&(k=t(p,g,E),k&&(m=Math.max(0,g-E),m=p.lastIndexOf(k.start,m-k.end.length-1),m!==-1&&(u=h.createRng(),u.setStart(c,m),u.setEnd(c,g-E),k=r(u.toString()),k&&k.end&&!(c.data.length<=k.start.length+k.end.length)))))){return d=n.formatter.get(k.format),d&&d[0].inline?(F(),n.formatter.apply(k.format,{},c),c):void 0}}function s(){var d,h,u,g,j,b,c,f,k,m,p;if(d=n.selection,h=n.dom,d.isCollapsed()&&(c=h.getParent(d.getStart(),"p"))){for(k=new tinymce.dom.TreeWalker(c,c);j=k.next();){if(3==j.nodeType){g=j;break}}if(g){if(f=r(g.data),!f){return}if(m=d.getRng(!0),u=m.startContainer,p=m.startOffset,g==u&&(p=Math.max(0,p-f.start.length)),tinymce.trim(g.data).length==f.start.length){return}f.format&&(b=n.formatter.get(f.format),b&&b[0].block&&(g.deleteData(0,f.start.length),n.formatter.apply(f.format,{},g),m.setStart(u,p),m.collapse(!0),d.setRng(m))),f.cmd&&n.undoManager.transact(function(){g.deleteData(0,f.start.length),n.execCommand(f.cmd)})}}}function l(){var b,c;c=o(),c&&(b=n.dom.createRng(),b.setStart(c,c.data.length),b.setEnd(c,c.data.length),n.selection.setRng(b)),s()}function a(){var c,d,b,f,g;c=o(!0),c&&(g=n.dom,d=c.data.slice(-1),/[\u00a0 ]/.test(d)&&(c.deleteData(c.data.length-1,1),b=g.doc.createTextNode(d),c.nextSibling?g.insertAfter(b,c.nextSibling):c.parentNode.appendChild(b),f=g.createRng(),f.setStart(b,1),f.setEnd(b,1),n.selection.setRng(f)))}var q,i=!0;q=n.settings.textpattern_patterns||[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],n.on("keydown",function(b){13!=b.keyCode||tinymce.util.VK.modifierPressed(b)||l()},!0),n.on("keyup",function(b){32!=b.keyCode||tinymce.util.VK.modifierPressed(b)||a()}),this.getPatterns=e,this.setPatterns=function(b){q=b,i=!0}});