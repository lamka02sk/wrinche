tinymce.PluginManager.add("insertdatetime",function(h){function m(a,i){function e(o,l){if(o=""+o,o.length<l){for(var q=0;q<l-o.length;q++){o="0"+o}}return o}return i=i||new Date,a=a.replace("%D","%m/%d/%Y"),a=a.replace("%r","%I:%M:%S %p"),a=a.replace("%Y",""+i.getFullYear()),a=a.replace("%y",""+i.getYear()),a=a.replace("%m",e(i.getMonth()+1,2)),a=a.replace("%d",e(i.getDate(),2)),a=a.replace("%H",""+e(i.getHours(),2)),a=a.replace("%M",""+e(i.getMinutes(),2)),a=a.replace("%S",""+e(i.getSeconds(),2)),a=a.replace("%I",""+((i.getHours()+11)%12+1)),a=a.replace("%p",""+(i.getHours()<12?"AM":"PM")),a=a.replace("%B",""+h.translate(f[i.getMonth()])),a=a.replace("%b",""+h.translate(p[i.getMonth()])),a=a.replace("%A",""+h.translate(j[i.getDay()])),a=a.replace("%a",""+h.translate(c[i.getDay()])),a=a.replace("%%","%")}function d(q){var e=m(q);if(h.settings.insertdatetime_element){var a;a=m(/%[HMSIp]/.test(q)?"%Y-%m-%dT%H:%M":"%Y-%m-%d"),e='<time datetime="'+a+'">'+e+"</time>";var l=h.dom.getParent(h.selection.getStart(),"time");if(l){return void h.dom.setOuterHTML(l,e)}}h.insertContent(e)}var b,g,c="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),j="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),p="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),f="January February March April May June July August September October November December".split(" "),k=[];h.addCommand("mceInsertDate",function(){d(h.getParam("insertdatetime_dateformat",h.translate("%Y-%m-%d")))}),h.addCommand("mceInsertTime",function(){d(h.getParam("insertdatetime_timeformat",h.translate("%H:%M:%S")))}),h.addButton("insertdatetime",{type:"splitbutton",title:"Insert date/time",onclick:function(){d(b||g)},menu:k}),tinymce.each(h.settings.insertdatetime_formats||["%H:%M:%S","%Y-%m-%d","%I:%M:%S %p","%D"],function(a){g||(g=a),k.push({text:m(a),onclick:function(){b=a,d(a)}})}),h.addMenuItem("insertdatetime",{icon:"date",text:"Date/time",menu:k,context:"insert"})});