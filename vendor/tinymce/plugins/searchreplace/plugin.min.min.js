!function(){function b(d){return d&&1==d.nodeType&&"false"===d.contentEditable}function a(H,q,e,y,k){function E(g,d){if(d=d||0,!g[0]){throw"findAndReplaceDOMText cannot handle zero-length matches"}var h=g.index;if(d>0){var f=g[d];if(!f){throw"Invalid capture group"}h+=g[0].indexOf(f),g[0]=f}return[h,h+g[0].length,[g[0]]]}function I(d){var f;if(3===d.nodeType){return d.data}if(z[d.nodeName]&&!j[d.nodeName]){return""}if(f="",b(d)){return"\n"}if((j[d.nodeName]||w[d.nodeName])&&(f+="\n"),d=d.firstChild){do{f+=I(d)}while(d=d.nextSibling)}return f}function x(O,m,g){var v,h,M,P,p=[],N=0,L=O,K=m.shift(),J=0;b:for(;;){if((j[L.nodeName]||w[L.nodeName]||b(L))&&N++,3===L.nodeType&&(!h&&L.length+N>=K[1]?(h=L,P=K[1]-N):v&&p.push(L),!v&&L.length+N>K[0]&&(v=L,M=K[0]-N),N+=L.length),v&&h){if(L=g({startNode:v,startNodeIndex:M,endNode:h,endNodeIndex:P,innerNodes:p,match:K[2],matchIndex:J}),N-=h.length-P,v=null,h=null,p=[],K=m.shift(),J++,!K){break}}else{if(z[L.nodeName]&&!j[L.nodeName]||!L.firstChild){if(L.nextSibling){L=L.nextSibling;continue}}else{if(!b(L)){L=L.firstChild;continue}}}for(;;){if(L.nextSibling){L=L.nextSibling;break}if(L.parentNode===O){break b}L=L.parentNode}}}function G(f){var d;if("function"!=typeof f){var g=f.nodeType?f:B.createElement(f);d=function(l,h){var i=g.cloneNode(!1);return i.setAttribute("data-mce-index",h),l&&i.appendChild(B.createTextNode(l)),i}}else{d=f}return function(R){var L,t,O,K=R.startNode,U=R.endNode,X=R.matchIndex;if(K===U){var N=K;O=N.parentNode,R.startNodeIndex>0&&(L=B.createTextNode(N.data.substring(0,R.startNodeIndex)),O.insertBefore(L,N));var W=d(R.match[0],X);return O.insertBefore(W,N),R.endNodeIndex<N.length&&(t=B.createTextNode(N.data.substring(R.endNodeIndex)),O.insertBefore(t,N)),N.parentNode.removeChild(N),W}L=B.createTextNode(K.data.substring(0,R.startNodeIndex)),t=B.createTextNode(U.data.substring(R.endNodeIndex));for(var T=d(K.data.substring(R.startNodeIndex),X),S=[],J=0,P=R.innerNodes.length;J<P;++J){var M=R.innerNodes[J],Q=d(M.data,X);M.parentNode.replaceChild(Q,M),S.push(Q)}var V=d(U.data.substring(0,R.endNodeIndex),X);return O=K.parentNode,O.insertBefore(L,K),O.insertBefore(T,K),O.removeChild(K),O=U.parentNode,O.insertBefore(V,U),O.insertBefore(t,U),O.removeChild(U),V}}var D,C,B,j,z,w,A=[],F=0;if(B=q.ownerDocument,j=k.getBlockElements(),z=k.getWhiteSpaceElements(),w=k.getShortEndedElements(),C=I(q)){if(H.global){for(;D=H.exec(C);){A.push(E(D,y))}}else{D=C.match(H),A.push(E(D,y))}return A.length&&(F=A.length,x(q,A,G(e))),F}}function c(m){function h(){function e(){s.statusbar.find("#next").disabled(!t(p+1).length),s.statusbar.find("#prev").disabled(!t(p-1).length)}function u(){m.windowManager.alert("Could not find the specified string.",function(){s.find("#find")[0].focus()})}var l,d={};l=tinymce.trim(m.selection.getContent({format:"text"}));var s=m.windowManager.open({layout:"flex",pack:"center",align:"center",onClose:function(){m.focus(),q.done()},onSubmit:function(y){var x,o,i,n;return y.preventDefault(),o=s.find("#case").checked(),n=s.find("#words").checked(),i=s.find("#find").value(),i.length?d.text==i&&d.caseState==o&&d.wholeWord==n?0===t(p+1).length?void u():(q.next(),void e()):(x=q.find(i,o,n),x||u(),s.statusbar.items().slice(1).disabled(0===x),e(),void (d={text:i,caseState:o,wholeWord:n})):(q.done(!1),void s.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){s.submit()}},{text:"Replace",disabled:!0,onclick:function(){q.replace(s.find("#replace").value())||(s.statusbar.items().slice(1).disabled(!0),p=-1,d={})}},{text:"Replace all",disabled:!0,onclick:function(){q.replace(s.find("#replace").value(),!0,!0),s.statusbar.items().slice(1).disabled(!0),d={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){q.prev(),e()}},{text:"Next",name:"next",disabled:!0,onclick:function(){q.next(),e()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:l},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}})}function f(i){var d=i.getAttribute("data-mce-index");return"number"==typeof d?""+d:d}function k(l){var e,d;return d=m.dom.create("span",{"data-mce-bogus":1}),d.className="mce-match-marker",e=m.getBody(),q.done(!1),a(l,e,d,!1,m.schema)}function g(i){var d=i.parentNode;i.firstChild&&d.insertBefore(i.firstChild,i),i.parentNode.removeChild(i)}function t(l){var s,e=[];if(s=tinymce.toArray(m.getBody().getElementsByTagName("span")),s.length){for(var r=0;r<s.length;r++){var d=f(s[r]);null!==d&&d.length&&d===l.toString()&&e.push(s[r])}}return e}function w(e){var o=p,l=m.dom;e=e!==!1,e?o++:o--,l.removeClass(t(p),"mce-match-marker-selected");var d=t(o);return d.length?(l.addClass(t(o),"mce-match-marker-selected"),m.selection.scrollIntoView(d[0]),o):-1}function j(d){var i=m.dom,e=d.parentNode;i.remove(d),i.isEmpty(e)&&i.remove(e)}function v(i){var d=f(i);return null!==d&&d.length>0}var q=this,p=-1;q.init=function(d){d.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:h,separator:"before",context:"edit"}),d.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:h}),d.addCommand("SearchReplace",h),d.shortcuts.add("Meta+F","",h)},q.find=function(l,d,o){l=l.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),l=o?"\\b"+l+"\\b":l;var i=k(new RegExp(l,d?"g":"gi"));return i&&(p=-1,p=w(!0)),i},q.next=function(){var d=w(!0);d!==-1&&(p=d)},q.prev=function(){var d=w(!1);d!==-1&&(p=d)},q.replace=function(B,e,o){var C,x,d,r,l,u,A=p;for(e=e!==!1,d=m.getBody(),x=tinymce.grep(tinymce.toArray(d.getElementsByTagName("span")),v),C=0;C<x.length;C++){var z=f(x[C]);if(r=l=parseInt(z,10),o||r===p){for(B.length?(x[C].firstChild.nodeValue=B,g(x[C])):j(x[C]);x[++C];){if(r=parseInt(f(x[C]),10),r!==l){C--;break}j(x[C])}e&&A--}else{l>p&&x[C].setAttribute("data-mce-index",l-1)}}return m.undoManager.add(),p=A,e?(u=t(A+1).length>0,q.next()):(u=t(A-1).length>0,q.prev()),!o&&u},q.done=function(x){var z,r,e,y;for(r=tinymce.toArray(m.getBody().getElementsByTagName("span")),z=0;z<r.length;z++){var d=f(r[z]);null!==d&&d.length&&(d===p.toString()&&(e||(e=r[z].firstChild),y=r[z].firstChild),g(r[z]))}if(e&&y){var o=m.dom.createRng();return o.setStart(e,0),o.setEnd(y,y.data.length),x!==!1&&m.selection.setRng(o),o}}}tinymce.PluginManager.add("searchreplace",c)}();