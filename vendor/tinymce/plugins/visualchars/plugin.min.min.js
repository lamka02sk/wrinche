tinymce.PluginManager.add("visualchars",function(d){function b(B){function j(g){return'<span data-mce-bogus="1" class="mce-'+e[g]+'">'+g+"</span>"}function i(){var h,g="";for(h in e){g+=h}return new RegExp("["+g+"]","g")}function z(){var h,g="";for(h in e){g&&(g+=","),g+="span.mce-"+e[h]}return g}var C,q,A,y,x,w,e,r,k=d.getBody(),v=d.selection;if(e={"\xa0":"nbsp","\xad":"shy"},c=!c,a.state=c,d.fire("VisualChars",{state:c}),r=i(),B&&(w=v.getBookmark()),c){for(q=[],tinymce.walk(k,function(g){3==g.nodeType&&g.nodeValue&&r.test(g.nodeValue)&&q.push(g)},"childNodes"),A=0;A<q.length;A++){for(y=q[A].nodeValue,y=y.replace(r,j),x=d.dom.create("div",null,y);C=x.lastChild;){d.dom.insertAfter(C,q[A])}d.dom.remove(q[A])}}else{for(q=d.dom.select(z(),k),A=q.length-1;A>=0;A--){d.dom.remove(q[A],1)}}v.moveToBookmark(w)}function f(){var e=this;d.on("VisualChars",function(g){e.active(g.state)})}var c,a=this;d.addCommand("mceVisualChars",b),d.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:f}),d.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:f,selectable:!0,context:"view",prependToContext:!0})});