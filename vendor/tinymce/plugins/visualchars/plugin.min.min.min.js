tinymce.PluginManager.add("visualchars",function(i){function e(d){function m(k){return'<span data-mce-bogus="1" class="mce-'+o[k]+'">'+k+"</span>"}function n(){var k,q="";for(k in o){q+=k}return new RegExp("["+q+"]","g")}function p(){var k,q="";for(k in o){q&&(q+=","),q+="span.mce-"+o[k]}return q}var b,c,f,s,t,u,o,a,l=i.getBody(),D=i.selection;if(o={"\xa0":"nbsp","\xad":"shy"},j=!j,g.state=j,i.fire("VisualChars",{state:j}),a=n(),d&&(u=D.getBookmark()),j){for(c=[],tinymce.walk(l,function(k){3==k.nodeType&&k.nodeValue&&a.test(k.nodeValue)&&c.push(k)},"childNodes"),f=0;f<c.length;f++){for(s=c[f].nodeValue,s=s.replace(a,m),t=i.dom.create("div",null,s);b=t.lastChild;){i.dom.insertAfter(b,c[f])}i.dom.remove(c[f])}}else{for(c=i.dom.select(p(),l),f=c.length-1;f>=0;f--){i.dom.remove(c[f],1)}}D.moveToBookmark(u)}function h(){var a=this;i.on("VisualChars",function(b){a.active(b.state)})}var j,g=this;i.addCommand("mceVisualChars",e),i.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:h}),i.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:h,selectable:!0,context:"view",prependToContext:!0})});