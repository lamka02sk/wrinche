function ComponentsModule(){this.modulesCache={};this.components=[];this.modules={};this.initializeEvent=function(eventData){let eventList=eventData.event.trim().split(" ");if(eventData.element[0]!==undefined){for(let element=0;element<eventData.element.length;++element){for(let event=0;event<eventList.length;++event){eventData.element[element].addEventListener(eventList[event],eventData.content)}}}else{for(let i=0;i<eventList.length;++i){eventData.element.addEventListener(eventList[i],eventData.content)}}};this.initializeEvents=function(events){for(let eventData=0;eventData<events.length;++eventData){componentsModule.initializeEvent(events[eventData])}};this.loadComponent=function(component){componentsModule.modules[component]={};let cache=componentsModule.modulesCache;if(!(component in cache)){cache[component]=getFile("app/Components/Scripts/"+component+".min.js")}eval(cache[component])};this.initializeComponent=function(component){componentsModule.loadComponent(component);let componentData=componentsModule.modules[component];if(componentData.start){componentData.start()}if(componentData.resume){componentData.resume()}if(!componentData.events){return false}let eventsData=componentData.events;componentsModule.initializeEvents(eventsData)};this.initializeComponents=function(){let componentsList=componentsModule.components;if(localStorage){componentsModule.modulesCache=JSON.parse(localStorage.getItem("wrinche.componentsCache"))||{};componentsModule.checkComponentsIntegrity()}for(let component=0;component<componentsList.length;++component){componentsModule.initializeComponent(componentsList[component])}if(localStorage){localStorage.setItem("wrinche.componentsCache",JSON.stringify(componentsModule.modulesCache))}};this.checkComponentsIntegrity=function(){let componentHashes=getJson(URI+"api/system.check.integrity.components&csrf_token="+csrf_token).data;let generator,hash;for(let componentName in componentsModule.modulesCache){generator=new jsSHA("SHA-256","TEXT");generator.update(componentsModule.modulesCache[componentName]);hash=generator.getHash("HEX");if(hash!==componentHashes[componentName]){delete componentsModule.modulesCache[componentName]}}};this.start=function(components){componentsModule.components=components;componentsModule.initializeComponents();componentsModule.resumeComponents()};this.validate=function(){for(let component=0;component<componentsModule.components.length;++component){if(!this.modules[componentsModule.components[component]].validate()){return false}}return true};this.serialize=function(){let result={};for(let component=0;component<componentsModule.components.length;++component){let componentName=componentsModule.components[component];result[componentName]=componentsModule.modules[componentName].serialize()}return result};this.createFromTemplate=function(componentName){let templateElement=document.querySelector("#component_"+componentName+"_template");if(!templateElement){return false}return templateElement.children[0].cloneNode(true)};this.createComponent=function(componentName){let inlineElement=document.querySelector("div.content-builder-content");if(typeof inlineElement==="undefined"){return false}if(!(componentName in componentsModule.modules)){return false}if(!("create" in componentsModule.modules[componentName])){return false}let emptyElement=inlineElement.querySelector("p.empty");let template=componentsModule.createFromTemplate(componentName);if(!template){return false}if(emptyElement!==null){inlineElement.removeChild(emptyElement)}let identifier=+new Date();template.setAttribute("data-id",identifier);componentsModule.modules[componentName].create(identifier,template);componentsModule.registerEvents(componentName,identifier,template);inlineElement.appendChild(template);if("onCreate" in componentsModule.modules[componentName]){componentsModule.modules[componentName].onCreate(identifier)}};this.registerEvents=function(name,identifier,parentElement,data){let headerElement=parentElement.querySelector("div.component-element-header");let contentElement=parentElement.querySelector("div.component-element-content");let titleElement=headerElement.children[1];let titleDefault=titleElement.innerText;if(data&&data.title!==""){titleElement.innerText=data.title.trim()}componentsModule.initializeEvents([{event:"click",element:headerElement,content:function(event){if(!event.target){return false}let element=event.target;if(element.matches(".component-inline-label")){element.focus();document.execCommand("selectAll",false,null)}else{if(element.matches(".component-inline-collapse")){contentElement.classList.toggle("hide")}else{if(element.matches(".component-inline-disable")){parentElement.classList.toggle("disabled");element.classList.toggle("icon-off");componentsModule.modules[name].data[identifier].disabled^=true}else{if(element.matches(".component-inline-remove")){let componentName=headerElement.querySelector(".component-inline-label").innerText.trim();let actionText=translate.locale.response.ACTION_CONFIRM_REMOVE_COMPONENT.replace("%component%",componentName);confirmAction(actionText,function(){parentElement.parentNode.removeChild(parentElement);delete componentsModule.modules[name].data[identifier]})}}}}}},{event:"blur",element:titleElement,content:function(){if(titleElement.innerText.trim()===""){titleElement.innerText=titleDefault}}},{event:"keypress",element:titleElement,content:function(event){if(!event.keyCode||event.keyCode!==13){return false}titleElement.blur();window.getSelection().removeAllRanges();event.preventDefault()}},{event:"keyup change",element:titleElement,content:function(event){componentsModule.modules[name].data[identifier].title=event.target.innerText.trim()}}]);if(data&&data.disabled!==0){triggerEvent(headerElement.querySelector(".component-inline-disable"),"click")}};this.resumeComponents=function(){let contentElement=document.querySelector("[data-order]");if(!contentElement){return true}const order=JSON.parse(contentElement.getAttribute("data-order"));if(!order||order===""){return true}let componentsResumeData={};componentsModule.components.forEach(function(componentName){let template=componentsModule.createFromTemplate(componentName);if(!template){return false}const resumeData=template.getAttribute("data-resume");if(!resumeData){return false}componentsResumeData[componentName]={template:template,resume:JSON.parse(resumeData)}});let emptyElement=contentElement.querySelector("p.empty");order.forEach(function(componentID){componentsModule.components.some(function(componentName){if(!componentsResumeData[componentName]||!componentsResumeData[componentName].template||!componentsResumeData[componentName].resume||!componentsResumeData[componentName].resume[componentID]){return false}const data=componentsResumeData[componentName];let template=data.template.cloneNode(true);const resumeData=data.resume[componentID];if(emptyElement!==null){contentElement.removeChild(emptyElement)}template.setAttribute("data-id",componentID);if(!componentsModule.modules[componentName].resumeInline){return false}componentsModule.modules[componentName].resumeInline(componentID,template,resumeData);componentsModule.registerEvents(componentName,componentID,template,resumeData);contentElement.appendChild(template);if(componentsModule.modules[componentName].onCreate){componentsModule.modules[componentName].onCreate(componentID)}return true})})}}let componentsModule=new ComponentsModule();