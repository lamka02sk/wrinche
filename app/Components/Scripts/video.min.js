componentsModule.modules.video={data:{},valid:{},YT_QUALITY:{small:"240p (LQ)",medium:"360p (SQ)",large:"480p (HQ)",hd720:"720p (HD)",hd1080:"1080p (FullHD)",highres:"1440p+ (QHD+)"},resumeInline:function(b,c,a){let current=componentsModule.modules.video;let path=a.video;current.create(b,c);current.onSelect(b,c,path,true,function(d,e){let descriptionText=a.video_description.trim();if(descriptionText==="false"){descriptionText=""}d.value=descriptionText;triggerEvent(d,"change");e[a.video_align].click()})},videoType:function(a){if(/^((?:https?:)?\/\/)?((?:www|m|player)\.)?((?:vimeo\.com))(?:$|\/|)(\S+)?$/gm.test(a)){return 1}else{if(/(https?:\/\/.*?youtube\.com)\/watch\?v=(.*)/igm.test(a)){return 0}else{return -1}}},registerEvents:function(b,a,c,d){let alignOptions=b.children[6].querySelectorAll("span");componentsModule.initializeEvents([{event:"change keyup",element:b.children[4].children[1],content:function(e){componentsModule.modules.video.data[a].video_description=e.target.value.trim()}},{event:"click",element:alignOptions,content:function(e){componentsModule.modules.video.data[a].video_align=+e.target.getAttribute("data-value");alignOptions.forEach(function(f){f.classList.remove("active")});e.target.classList.add("active")}}]);b.children[5].addEventListener("click",function(){componentsModule.modules.video.removeInstance(a,c,b)});if(d){d(b.children[4].children[1],alignOptions)}},loadExternalVideo:function(a,b,d,c,e){document.querySelector("div.media-manager span.close-manager").click();let video=document.createElement("video");video.setAttribute("src",d);video.classList.add("item-player");video.setAttribute("controls","true");video.volume=0.5;let contentElement=b.querySelector("div.component-element-content");contentElement.classList.add("no-padding");contentElement.querySelector("div.select-image").classList.add("hide");c.insertBefore(video,c.children[0]);contentElement.appendChild(c);c.children[1].innerText=d.replace("app/Data/Files/Videos/","");video.addEventListener("loadedmetadata",function(){let duration=video.duration;let minutes=parseInt(duration/60,10);let seconds=duration%60;let time=minutes+":"+pad(Math.round(seconds),2);let width=video.videoWidth;let height=video.videoHeight;let dimensions=width+"x"+height;c.children[2].innerText=time;c.children[3].innerText=dimensions});componentsModule.modules.video.registerEvents(c,a,contentElement,e)},loadYouTubeVideo:function(b,c,e,d,g){let video=document.createElement("div");const f="youtube-player-"+b;video.setAttribute("id",f);let contentElement=c.querySelector("div.component-element-content");contentElement.classList.add("no-padding");contentElement.querySelector("div.select-image").classList.add("hide");let container=document.createElement("div");container.classList.add("iframe-container");container.appendChild(video);d.insertBefore(container,d.children[0]);contentElement.appendChild(d);let videoId=e.split("v=")[1];let ampersandPosition=videoId.indexOf("&");if(ampersandPosition!==-1){videoId=videoId.substring(0,ampersandPosition)}function a(){new YT.Player(f,{videoId:videoId,events:{onReady:function(h){tmp=h.target.getPlaylist();d.children[1].innerText=h.target.getVideoData().title;let duration=h.target.getDuration();let minutes=parseInt(duration/60,10);let seconds=duration%60;d.children[2].innerText=minutes+":"+pad(Math.round(seconds),2);h.target.setPlaybackQuality("medium")},onStateChange:function(h){d.children[3].innerText=(h.target.getAvailableQualityLevels()[0]!==undefined)?componentsModule.modules.video.YT_QUALITY[h.target.getAvailableQualityLevels()[0]]:""}}})}setTimeout(a);componentsModule.modules.video.registerEvents(d,b,contentElement,g)},loadVimeoVideo:function(a,b,d,c,e){let video=getJson("https://vimeo.com/api/oembed.json?url="+d);let contentElement=b.querySelector("div.component-element-content");contentElement.classList.add("no-padding");contentElement.querySelector("div.select-image").classList.add("hide");let container=document.createElement("div");container.classList.add("iframe-container");container.insertAdjacentHTML("afterbegin",video.html);c.insertBefore(container,c.children[0]);contentElement.appendChild(c);c.children[1].innerText=video.title;let duration=video.duration;let minutes=parseInt(duration/60,10);let seconds=duration%60;c.children[2].innerText=minutes+":"+pad(Math.round(seconds),2);let channelURL=document.createElement("a");channelURL.setAttribute("href",video.author_url);channelURL.setAttribute("target","_blank");channelURL.innerText=video.author_name;c.children[3].appendChild(channelURL);componentsModule.modules.video.registerEvents(c,a,contentElement,e)},removeInstance:function(a,c,b){c.querySelector("div.input-box.select-image").classList.remove("hide");c.removeChild(b);c.classList.remove("no-padding");delete componentsModule.modules.video.data[a]},remove:function(a){a.querySelectorAll("div.component-instance").forEach(function(b){b.querySelector("span.item-remove").click()})},onSelect:function(a,b,d,c,e){componentsModule.modules.video.remove(b);if(!c){d="app/Data/Files/Videos/"+d}componentsModule.modules.video.data[a]={title:"",video:d,video_description:false,video_align:1,disabled:0};let type=componentsModule.modules.video.videoType(d);let template=b.querySelector("#template_component_content_video_item").children[0].cloneNode(true);template.setAttribute("data-path",d);switch(type){case -1:componentsModule.modules.video.loadExternalVideo(a,b,d,template,e);break;case 0:componentsModule.modules.video.loadYouTubeVideo(a,b,d,template,e);break;case 1:componentsModule.modules.video.loadVimeoVideo(a,b,d,template,e);break;default:return false;break}},create:function(a,b){componentsModule.initializeEvents([{event:"click",element:b.querySelector("button.inline-image_manager"),content:function(){managerActiveInstance=new MediaManager({manager:"videos",onSelect:function(c){componentsModule.modules.video.onSelect(a,b,c,false)}})}},{event:"keyup",element:b.querySelector("input[name=component_inline_video_input]"),content:function(c){if(c.keyCode!==13||c.target.value.trim().length<4){return false}componentsModule.modules.video.onSelect(a,b,c.target.value.trim(),true)}}])},validate:function(){return true},serialize:function(){return componentsModule.modules.video.data}};