componentsModule.modules.video={data:{},valid:{},YT_QUALITY:{small:"240p (LQ)",medium:"360p (SQ)",large:"480p (HQ)",hd720:"720p (HD)",hd1080:"1080p (FullHD)",highres:">= 1440p (>= QHD)"},videoType:function(a){if(/^((?:https?:)?\/\/)?((?:www|m|player)\.)?((?:vimeo\.com))(?:$|\/|)(\S+)?$/gm.test(a)){return 1}else{if(/(https?:\/\/.*?youtube\.com)\/watch\?v=(.*)/igm.test(a)){return 0}else{return -1}}},registerEvents:function(b,a,c){let alignOptions=b.children[6].querySelectorAll("span");componentsModule.initializeEvents([{event:"change keyup",element:b.children[4].children[1],content:function(d){componentsModule.modules.video.data[a].video_description=d.target.value.trim()}},{event:"click",element:alignOptions,content:function(d){componentsModule.modules.video.data[a].video_align=+d.target.getAttribute("data-value");alignOptions.forEach(function(e){e.classList.remove("active")});d.target.classList.add("active")}}]);b.children[5].addEventListener("click",function(){componentsModule.modules.video.removeInstance(a,c,b)})},loadExternalVideo:function(a,b,d,c){document.querySelector("div.media-manager span.close-manager").click();let video=document.createElement("video");video.setAttribute("src",d);video.classList.add("item-player");video.setAttribute("controls","true");video.volume=0.5;let contentElement=b.querySelector("div.component-element-content");contentElement.classList.add("no-padding");contentElement.querySelector("div.select-image").classList.add("hide");c.insertBefore(video,c.children[0]);contentElement.appendChild(c);c.children[1].innerText=d;video.addEventListener("loadedmetadata",function(){let duration=video.duration;let minutes=parseInt(duration/60,10);let seconds=duration%60;let time=minutes+":"+pad(Math.round(seconds),2);let width=video.videoWidth;let height=video.videoHeight;let dimensions=width+"x"+height;c.children[2].innerText=time;c.children[3].innerText=dimensions});componentsModule.modules.video.registerEvents(c,a,contentElement)},loadYouTubeVideo:function(a,b,d,c){let video=document.createElement("div");video.setAttribute("id","youtube-player-"+a);let contentElement=b.querySelector("div.component-element-content");contentElement.classList.add("no-padding");contentElement.querySelector("div.select-image").classList.add("hide");let container=document.createElement("div");container.classList.add("iframe-container");container.appendChild(video);c.insertBefore(container,c.children[0]);contentElement.appendChild(c);let videoId=d.split("v=")[1];let ampersandPosition=videoId.indexOf("&");if(ampersandPosition!==-1){videoId=videoId.substring(0,ampersandPosition)}let player=new YT.Player("youtube-player-"+a,{videoId:videoId,events:{onReady:function(e){tmp=e.target.getPlaylist();c.children[1].innerText=e.target.getVideoData().title;let duration=e.target.getDuration();let minutes=parseInt(duration/60,10);let seconds=duration%60;c.children[2].innerText=minutes+":"+pad(Math.round(seconds),2);e.target.setPlaybackQuality("medium")},onStateChange:function(e){c.children[3].innerText=(e.target.getAvailableQualityLevels()[0]!==undefined)?componentsModule.modules.video.YT_QUALITY[e.target.getAvailableQualityLevels()[0]]:""}}});componentsModule.modules.video.registerEvents(c,a,contentElement)},loadVimeoVideo:function(a,b,d,c){let video=getJson("https://vimeo.com/api/oembed.json?url="+d);let contentElement=b.querySelector("div.component-element-content");contentElement.classList.add("no-padding");contentElement.querySelector("div.select-image").classList.add("hide");let container=document.createElement("div");container.classList.add("iframe-container");container.insertAdjacentHTML("afterbegin",video.html);c.insertBefore(container,c.children[0]);contentElement.appendChild(c);c.children[1].innerText=video.title;let duration=video.duration;let minutes=parseInt(duration/60,10);let seconds=duration%60;c.children[2].innerText=minutes+":"+pad(Math.round(seconds),2);let channelURL=document.createElement("a");channelURL.setAttribute("href",video.author_url);channelURL.setAttribute("target","_blank");channelURL.innerText=video.author_name;c.children[3].appendChild(channelURL);componentsModule.modules.video.registerEvents(c,a,contentElement)},removeInstance:function(a,c,b){c.querySelector("div.input-box.select-image").classList.remove("hide");c.removeChild(b);c.classList.remove("no-padding");delete componentsModule.modules.video.data[a]},remove:function(a){a.querySelectorAll("div.component-instance").forEach(function(b){b.querySelector("span.item-remove").click()})},onSelect:function(a,b,d,c){componentsModule.modules.video.remove(b);if(!c){d="app/Data/Files/Videos/"+d}componentsModule.modules.video.data[a]={title:"",video:d,video_description:false,video_align:1,type:-1,valid:true,disabled:0};let type=componentsModule.modules.video.videoType(d);let template=b.querySelector("#template_component_content_video_item").children[0].cloneNode(true);template.setAttribute("data-path",d);switch(type){case -1:componentsModule.modules.video.loadExternalVideo(a,b,d,template);break;case 0:componentsModule.modules.video.loadYouTubeVideo(a,b,d,template);break;case 1:componentsModule.modules.video.loadVimeoVideo(a,b,d,template);break;default:return false;break}},create:function(a,b){componentsModule.initializeEvents([{event:"click",element:b.querySelector("button.inline-image_manager"),content:function(){managerActiveInstance=new MediaManager({manager:"videos",onSelect:function(c){componentsModule.modules.video.onSelect(a,b,c,false)}})}},{event:"keyup",element:b.querySelector("input[name=component_inline_video_input]"),content:function(c){if(c.keyCode!==13||c.target.value.trim().length<4){return false}componentsModule.modules.video.onSelect(a,b,c.target.value.trim(),true)}}])},validate:function(){return true},serialize:function(){return componentsModule.modules.video.data}};