componentsModule.modules.poll={data:{},itemClone:false,validate:function(){return true},serialize:function(){return componentsModule.modules.poll.data},reloadItems:function(a,b){let newOrder=[];let newContent=[];b.querySelectorAll(".poll-item").forEach(function(c){newOrder.push(parseFloat(c.getAttribute("data-item")));let text=c.querySelector("p").innerText.trim();if(text===componentsModule.modules.poll.itemClone.querySelector("p").innerText.trim()){text=""}newContent.push(text)});componentsModule.modules.poll.data[a].poll=newContent;componentsModule.modules.poll.data[a].order=newOrder},createItem:function(b,c,d,a){let itemID=Math.random()*(99999-10000)+10000;let index;if(!d){componentsModule.modules.poll.data[b].poll.push("");componentsModule.modules.poll.data[b].order.push(itemID);index=+componentsModule.modules.poll.data[b].order.indexOf(itemID)}else{index=+componentsModule.modules.poll.data[b].order.indexOf(d);if(index===-1){return false}index+=1;componentsModule.modules.poll.data[b].poll.splice(index,0,"");componentsModule.modules.poll.data[b].order.splice(index,0,itemID)}let itemElement=componentsModule.modules.poll.itemClone.cloneNode(true);itemElement.setAttribute("data-item",itemID.toString());let itemText=itemElement.querySelector("p");componentsModule.initializeEvents([{event:"focus",element:itemText,content:function(e){if(e.target.innerText.trim()!==componentsModule.modules.poll.itemClone.querySelector("p").innerText){return false}e.target.classList.remove("item-text-placeholder");e.target.innerText=""}},{event:"blur",element:itemText,content:function(e){if(!componentsModule.modules.poll.data[b].order[index+1]&&e.target.innerText.trim()!==""){componentsModule.modules.poll.createItem(b,c,itemID)}if(e.target.innerText.trim()!==""){return false}e.target.classList.add("item-text-placeholder");e.target.innerText=componentsModule.modules.poll.itemClone.querySelector("p").innerText}},{event:"keydown",element:itemText,content:function(e){if(e.keyCode!==13){return false}if(!componentsModule.modules.poll.data[b].order[index+1]&&e.target.innerText.trim()!==""){componentsModule.modules.poll.createItem(b,c,itemID,true)}else{if(e.shiftKey){if(!(!itemElement.previousSibling)){itemElement.previousSibling.querySelector("p").focus()}}else{if(!(!itemElement.nextSibling)){itemElement.nextSibling.querySelector("p").focus()}}}e.preventDefault()}},{event:"keyup change",element:itemText,content:function(e){componentsModule.modules.poll.data[b].poll[index]=e.target.innerText.trim()}},{event:"click",element:itemElement.querySelector(".poll-item-delete"),content:function(){if(c.children.length<2){return false}let index=componentsModule.modules.poll.data[b].order.indexOf(itemID);if(index===-1){return false}componentsModule.modules.poll.data[b].poll.splice(index,1);componentsModule.modules.poll.data[b].order.splice(index,1);c.removeChild(itemElement);componentsModule.modules.poll.reloadItems(b,c)}}]);if(!d){c.appendChild(itemElement)}else{if(!componentsModule.modules.poll.data[b].order[index+1]){c.appendChild(itemElement)}else{c.insertBefore(itemElement,c.children[index+1])}}if(a){itemText.focus()}},create:function(a,b){let contentElement=b.querySelector(".component-element-content");let listElement=contentElement.querySelector(".component-inline-poll-content");let listItem=listElement.querySelector(".poll-item");if(!componentsModule.modules.poll.itemClone){componentsModule.modules.poll.itemClone=listItem.cloneNode(true)}listElement.removeChild(listItem);componentsModule.modules.poll.data[a]={title:"",disabled:0,poll:[],order:[],poll_title:"",poll_type:0,poll_position:1};Sortable.create(listElement,{sort:true,animation:200,scroll:false,draggable:".poll-item",handle:".poll-item-move",onStart:function(c){c.item.classList.add("chosen")},onEnd:function(c){c.item.classList.remove("chosen");componentsModule.modules.poll.reloadItems(a,listElement)}});let typeItems=contentElement.querySelectorAll(".component-poll_type .position-item");let positionItems=contentElement.querySelectorAll(".component-poll_align .position-item");componentsModule.initializeEvents([{event:"change keyup",element:contentElement.querySelector("input[name=component_inline_poll_name]"),content:function(c){componentsModule.modules.poll.data[a].poll_title=c.target.value.trim()}},{event:"click",element:typeItems,content:function(c){listElement.setAttribute("data-type",componentsModule.modules.poll.data[a].poll_type=c.target.getAttribute("data-position"));typeItems.forEach(function(d){d.classList.remove("active")});c.target.classList.add("active")}},{event:"click",element:positionItems,content:function(c){componentsModule.modules.poll.data[a].poll_position=c.target.getAttribute("data-position");positionItems.forEach(function(d){d.classList.remove("active")});c.target.classList.add("active")}}]);componentsModule.modules.poll.createItem(a,listElement)}};