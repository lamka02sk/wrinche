componentsModule.modules.poll={data:{},itemClone:false,validate:function(){return true},serialize:function(){return componentsModule.modules.poll.data},reloadItems:function(a,b){let newOrder=[];let newContent=[];let current=componentsModule.modules.poll;b.querySelectorAll(".poll-item").forEach(function(c){newOrder.push(parseFloat(c.getAttribute("data-item")));let text=c.querySelector("p").innerText.trim();if(text===current.itemClone.querySelector("p").innerText.trim()){text=""}newContent.push(text)});current.data[a].poll=newContent;current.data[a].order=newOrder},createItem:function(b,c,d,a){let current=componentsModule.modules.poll;let itemID=Math.random()*(99999-10000)+10000;let index;if(!d){current.data[b].poll.push("");current.data[b].order.push(itemID);index=+current.data[b].order.indexOf(itemID)}else{index=+current.data[b].order.indexOf(d);if(index===-1){return false}index+=1;current.data[b].poll.splice(index,0,"");current.data[b].order.splice(index,0,itemID)}let itemElement=current.itemClone.cloneNode(true);itemElement.setAttribute("data-item",itemID.toString());let itemText=itemElement.querySelector("p");componentsModule.initializeEvents([{event:"focus",element:itemText,content:function(e){if(e.target.innerText.trim()!==current.itemClone.querySelector("p").innerText){return false}e.target.classList.remove("item-text-placeholder");e.target.innerText=""}},{event:"blur",element:itemText,content:function(e){if(!current.data[b].order[index+1]&&e.target.innerText.trim()!==""){current.createItem(b,c,itemID)}if(e.target.innerText.trim()!==""){return false}e.target.classList.add("item-text-placeholder");e.target.innerText=current.itemClone.querySelector("p").innerText}},{event:"keydown",element:itemText,content:function(e){if(e.keyCode!==13){return false}if(!current.data[b].order[index+1]&&e.target.innerText.trim()!==""){current.createItem(b,c,itemID,true)}else{if(e.shiftKey){if(!(!itemElement.previousSibling)){itemElement.previousSibling.querySelector("p").focus()}}else{if(!(!itemElement.nextSibling)){itemElement.nextSibling.querySelector("p").focus()}}}e.preventDefault()}},{event:"keyup change",element:itemText,content:function(e){current.data[b].poll[index]=e.target.innerText.trim()}},{event:"click",element:itemElement.querySelector(".poll-item-delete"),content:function(){if(c.children.length<2){return false}let index=current.data[b].order.indexOf(itemID);if(index===-1){return false}current.data[b].poll.splice(index,1);current.data[b].order.splice(index,1);c.removeChild(itemElement);current.reloadItems(b,c)}}]);if(!d){c.appendChild(itemElement)}else{if(!current.data[b].order[index+1]){c.appendChild(itemElement)}else{c.insertBefore(itemElement,c.children[index+1])}}if(a){itemText.focus()}},create:function(a,b){let current=componentsModule.modules.poll;let contentElement=b.querySelector(".component-element-content");let listElement=contentElement.querySelector(".component-inline-poll-content");let listItem=listElement.querySelector(".poll-item");if(!current.itemClone){current.itemClone=listItem.cloneNode(true)}listElement.removeChild(listItem);current.data[a]={title:"",disabled:0,poll:[],order:[],poll_title:"",poll_type:0,poll_position:1};Sortable.create(listElement,{sort:true,animation:200,scroll:false,draggable:".poll-item",handle:".poll-item-move",onStart:function(c){c.item.classList.add("chosen")},onEnd:function(c){c.item.classList.remove("chosen");current.reloadItems(a,listElement)}});let typeItems=contentElement.querySelectorAll(".component-poll_type .position-item");let positionItems=contentElement.querySelectorAll(".component-poll_align .position-item");componentsModule.initializeEvents([{event:"change keyup",element:contentElement.querySelector("input[name=component_inline_poll_name]"),content:function(c){current.data[a].poll_title=c.target.value.trim()}},{event:"click",element:typeItems,content:function(c){listElement.setAttribute("data-type",current.data[a].poll_type=c.target.getAttribute("data-position"));typeItems.forEach(function(d){d.classList.remove("active")});c.target.classList.add("active")}},{event:"click",element:positionItems,content:function(c){current.data[a].poll_position=c.target.getAttribute("data-position");positionItems.forEach(function(d){d.classList.remove("active")});c.target.classList.add("active")}}]);current.createItem(a,listElement)}};