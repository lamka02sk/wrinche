componentsModule.modules.poll={data:{},itemClone:false,validate:function(){return true},serialize:function(){return componentsModule.modules.poll.data},resumeInline:function(b,c,a){let current=componentsModule.modules.poll;let listElement=current.create(b,c,a);a.poll.forEach(function(d){if(d===""){return true}current.createItem(b,listElement,undefined,false,d)});if(current.data[b].poll.length<1){current.createItem(b,listElement)}},reloadItems:function(a,b){let newOrder=[];let newContent=[];let current=componentsModule.modules.poll;b.querySelectorAll(".poll-item").forEach(function(c){newOrder.push(parseFloat(c.getAttribute("data-item")));let text=c.querySelector("p").innerText.trim();if(text===current.itemClone.querySelector("p").innerText.trim()){text=""}newContent.push(text)});current.data[a].poll=newContent;current.data[a].order=newOrder},createItem:function(c,d,e,a,b){if(!b){b=""}let current=componentsModule.modules.poll;let itemID=Math.random()*(99999-10000)+10000;let index;if(!e){current.data[c].poll.push(b);current.data[c].order.push(itemID);index=+current.data[c].order.indexOf(itemID)}else{index=+current.data[c].order.indexOf(e);if(index===-1){return false}index+=1;current.data[c].poll.splice(index,0,b);current.data[c].order.splice(index,0,itemID)}let itemElement=current.itemClone.cloneNode(true);let itemText=itemElement.querySelector("p");itemElement.setAttribute("data-item",itemID.toString());componentsModule.initializeEvents([{event:"focus",element:itemText,content:function(f){let target=f.target;if(target.innerText.trim()!==current.itemClone.querySelector("p").innerText){return false}target.classList.remove("item-text-placeholder");target.innerText=""}},{event:"blur",element:itemText,content:function(f){let target=f.target;let nextItem=target.parentNode.nextSibling;if(target.innerText.trim()!==""&&nextItem===null){current.createItem(c,d,itemID,true)}if(target.innerText.trim()!==""){return false}target.classList.add("item-text-placeholder");target.innerText=current.itemClone.querySelector("p").innerText}},{event:"keydown",element:itemText,content:function(f){if(f.keyCode!==13){return false}let currentItem=f.target.parentNode;let nextItem=currentItem.nextSibling;if(nextItem!==null){nextItem.querySelector("p").focus()}else{f.target.blur()}f.preventDefault()}},{event:"keyup change",element:itemText,content:function(f){current.data[c].poll[index]=f.target.innerText.trim()}},{event:"click",element:itemElement.querySelector(".poll-item-delete"),content:function(){if(d.children.length<2){return false}let index=current.data[c].order.indexOf(itemID);if(index===-1){return false}current.data[c].poll.splice(index,1);current.data[c].order.splice(index,1);d.removeChild(itemElement);current.reloadItems(c,d)}}]);if(!e){d.appendChild(itemElement)}else{if(!current.data[c].order[index+1]){d.appendChild(itemElement)}else{d.insertBefore(itemElement,d.children[index+1])}}itemText.innerText=(b)?b:itemText.innerText;if(b){itemText.classList.remove("item-text-placeholder")}if(a){itemText.focus()}},create:function(b,c,a){let current=componentsModule.modules.poll;let contentElement=c.querySelector(".component-element-content");let listElement=contentElement.querySelector(".component-inline-poll-content");let listItem=listElement.querySelector(".poll-item");if(!current.itemClone){current.itemClone=listItem.cloneNode(true)}listElement.removeChild(listItem);current.data[b]={title:"",disabled:0,poll:[],order:[],poll_title:"",poll_type:0,poll_position:1};Sortable.create(listElement,{sort:true,animation:200,scroll:false,draggable:".poll-item",handle:".poll-item-move",onStart:function(d){d.item.classList.add("chosen")},onEnd:function(d){d.item.classList.remove("chosen");current.reloadItems(b,listElement)}});let typeItems=contentElement.querySelectorAll(".component-poll_type .position-item");let positionItems=contentElement.querySelectorAll(".component-poll_align .position-item");let nameInput=contentElement.querySelector("input[name=component_inline_poll_name]");componentsModule.initializeEvents([{event:"change keyup",element:nameInput,content:function(d){current.data[b].poll_title=d.target.value.trim()}},{event:"click",element:typeItems,content:function(d){listElement.setAttribute("data-type",current.data[b].poll_type=d.target.getAttribute("data-position"));typeItems.forEach(function(e){e.classList.remove("active")});d.target.classList.add("active")}},{event:"click",element:positionItems,content:function(d){current.data[b].poll_position=d.target.getAttribute("data-position");positionItems.forEach(function(e){e.classList.remove("active")});d.target.classList.add("active")}}]);if(a!==undefined){nameInput.value=a.poll_title.trim();triggerEvent(nameInput,"change");typeItems[+a.poll_type].click();positionItems[+a.poll_position].click()}if(!a){current.createItem(b,listElement)}return listElement}};