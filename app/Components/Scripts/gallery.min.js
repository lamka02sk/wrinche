componentsModule.modules.gallery={data:{},validate:function(){return true},serialize:function(){return componentsModule.modules.gallery.data},resumeInline:function(b,c,a){let current=componentsModule.modules.gallery;current.create(b,c);a.gallery.forEach(function(d){current.onSelect(b,c,d,true)})},validateInput:function(a,b,c,d){if(!/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/.test(c)){showValidationResult(b,"COMPONENT_URL_INVALID",false,$.noop);return false}let promise=new Promise(function(f,e){let image=new Image;image.onload=function(){f(true)};image.onerror=function(){f(false)};image.src=c});promise.then(function(e){if(e){showValidationResult(b,"",true,$.noop);if(d){d(a,b,c,true)}return true}showValidationResult(b,"COMPONENT_URL_INVALID",false,$.noop)})},onSelect:function(a,b,d,c){let current=componentsModule.modules.gallery;let contentElement=b.querySelector("div.gallery-items");contentElement.classList.remove("no-padding");if(!c){d="app/Data/Files/Images/"+d}if(current.data[a]){if(~current.data[a].gallery.indexOf(d)){closeMediaManager();return false}current.data[a].gallery.push(d)}else{current.data[a]={title:"",gallery:[d],disabled:0}}if(!current.templateElement){current.templateElement=b.querySelector("#template_component_gallery_item").children[0].cloneNode(true)}let template=current.templateElement.cloneNode(true);template.setAttribute("data-path",d);template.classList.add("component-instance");template.children[0].children[0].setAttribute("src",d);template.children[0].children[0].setAttribute("alt",d);template.children[1].addEventListener("click",function(){contentElement.removeChild(template);for(let i=0;i<current.data[a].gallery.length;++i){if(current.data[a].gallery[i]===d){current.data[a].gallery.splice(i,1)}}});contentElement.appendChild(template);if(!c){document.querySelector("div.media-manager span.close-manager").click()}},create:function(a,b){let current=componentsModule.modules.gallery;componentsModule.initializeEvents([{event:"click",element:b.querySelector("button.inline-image_manager"),content:function(){managerActiveInstance=new MediaManager({manager:"images",onSelect:function(c){current.onSelect(a,b,c,false)}})}},{event:"keypress",element:b.querySelector("input[name=component_inline_picture_input]"),content:function(c){if(c.keyCode&&c.keyCode===13){let path=c.target.value.trim();current.validateInput(a,b,path,current.onSelect)}}},{event:"change keyup",element:b.querySelector("input[name=component_inline_picture_input]"),content:function(c){current.validateInput(a,b,c.target.value.trim())}}])}};