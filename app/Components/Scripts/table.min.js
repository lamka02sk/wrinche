componentsModule.modules.table={data:{},template:false,clones:{clone:false,actionRow:false,headerRow:false,tableRow:false,headerActionFirst:false,headerAction:false,asideActionFirst:false,asideAction:false,headerCell:false,contentCell:false,emptyCell:false},validate:function(){return true},serialize:function(){return componentsModule.modules.table.data},addRow:function(b,a,c){let current=componentsModule.modules.table;let clones=current.clones;let data=current.data[a];let tableRow=clones.tableRow.cloneNode(true);let actionCell=clones.asideAction.cloneNode(true);let columnID=data.table.order.columns[0];let headerCell=clones.headerCell.cloneNode(true);let rowID=Math.floor(Math.random()*(9999999-1000000))+1000000;tableRow.appendChild(actionCell);headerCell.setAttribute("data-column",data.table.order.columns[0]);tableRow.appendChild(headerCell);data.table.rows[rowID]={};tableRow.setAttribute("data-row",rowID);if(c===undefined){data.table.order.rows.push(rowID)}else{let beforeID=parseFloat(c.getAttribute("data-row"));let beforeIndex=data.table.order.rows.indexOf(beforeID);if(beforeIndex===-1){return false}data.table.order.rows.splice(beforeIndex,0,rowID)}if(data.table.hidden.columns.indexOf(columnID)!==-1){headerCell.classList.add("hidden")}for(let i=0;i<data.dimensions[0];++i){let contentCell=clones.contentCell.cloneNode(true);let columnID=data.table.order.columns[+i+1];contentCell.setAttribute("data-column",columnID);tableRow.appendChild(contentCell)}if(!c){b.appendChild(tableRow)}else{b.insertBefore(tableRow,c)}++data.dimensions[1];return b},addColumn:function(c,b,a){let current=componentsModule.modules.table;let data=current.data[b];let clones=current.clones;let columnID=Math.floor(Math.random()*(999999-100000))+100000;let actionRow=c.querySelector(".table-action-row");let actionCell=clones.headerAction.cloneNode(true);let headerRow=c.querySelector(".table-header-row");let headerCell=clones.headerCell.cloneNode(true);let contentRows=c.querySelectorAll(".table-row");let contentCell=clones.contentCell.cloneNode(true);if(a!==undefined){let afterIndex=data.table.order.columns.indexOf(parseInt(a));data.table.order.columns.splice(++afterIndex,0,columnID)}else{data.table.order.columns.push(columnID)}actionCell.setAttribute("data-column",columnID.toString());headerCell.setAttribute("data-column",columnID.toString());contentCell.setAttribute("data-column",columnID.toString());if(a===undefined){actionRow.appendChild(actionCell);headerRow.appendChild(headerCell);contentRows.forEach(function(d){d.appendChild(contentCell.cloneNode(true))})}else{let afterAction=actionRow.querySelector('[data-column="'+a+'"]');let afterHeader=headerRow.querySelector('[data-column="'+a+'"]');let done=false;actionRow.insertBefore(actionCell,afterAction.nextSibling);headerRow.insertBefore(headerCell,afterHeader.nextSibling);contentRows.forEach(function(d){if(done){return false}let afterCell=d.querySelector('[data-column="'+a+'"]');let clone=contentCell.cloneNode(true);d.insertBefore(clone,afterCell.nextSibling)})}++componentsModule.modules.table.data[b].dimensions[0];return c},allowHorizontalScrolling:function(a){componentsModule.initializeEvent({event:"wheel",element:a,content:function(b){this.scrollLeft-=-(b.deltaY*20);b.preventDefault()}})},createTemplateClones:function(a){let current=componentsModule.modules.table;let template=current.template;let clones=current.clones;if(template===false){current.template=template=a.querySelector("#template_inline_table_components").cloneNode(true).children[0]}if(clones.actionRow===false){clones.actionRow=template.querySelector(".table-action-row").cloneNode(true)}if(clones.headerActionFirst===false){clones.headerActionFirst=template.querySelector(".table-header-action-first").cloneNode(true)}if(clones.headerAction===false){clones.headerAction=template.querySelector(".table-header-action").cloneNode(true)}if(clones.emptyCell===false){clones.emptyCell=document.createElement("td")}if(clones.headerRow===false){clones.headerRow=template.querySelector(".table-header-row").cloneNode(true)}if(clones.asideActionFirst===false){clones.asideActionFirst=template.querySelector(".table-aside-action-first").cloneNode(true)}if(clones.headerCell===false){clones.headerCell=template.querySelector("th[contenteditable=true]").cloneNode(true)}if(clones.asideAction===false){clones.asideAction=template.querySelector(".table-aside-action").cloneNode(true)}if(clones.contentCell===false){clones.contentCell=template.querySelector("td[contenteditable=true]").cloneNode(true)}if(clones.tableRow===false){clones.tableRow=template.querySelector(".table-row").cloneNode(true)}},create:function(a,b){let current=componentsModule.modules.table;let contentElement=b.querySelector("div.table-box");let nameInput=b.querySelector("input[name=component_inline_table_name]");let clones=current.clones;let data=current.data;current.createTemplateClones(b);let table=document.createElement("table");let actionRow=clones.actionRow.cloneNode(true);let headerRow=clones.headerRow.cloneNode(true);let firstColumnID=Math.floor(Math.random()*(999999-100000))+100000;let firstRowID=Math.floor(Math.random()*(9999999-1000000))+1000000;let addRowElement=contentElement.querySelector(".table-add-button");current.allowHorizontalScrolling(contentElement);data[a]={title:"",table:{hidden:{columns:[],rows:[]},header:{},rows:{},name:"",order:{rows:[],columns:[]}},dimensions:[0,0],disabled:0};componentsModule.initializeEvents([{event:"input",element:nameInput,content:function(c){data[a].table.name=c.target.value.trim()}},{event:"click",element:table,content:function(c){let target=c.target;if(target.matches(".table-hide-column")){let columnID=target.parentNode.getAttribute("data-column");let hiddenIndex;let isHidden=~(hiddenIndex=data[a].table.hidden.columns.indexOf(columnID));let rowsList=table.querySelectorAll("tr");let rowSelector='[data-column="'+columnID+'"]';if(isHidden){rowsList.forEach(function(d){let rowID=d.getAttribute("data-row");let rowColumn=d.querySelector(rowSelector);let isHiddenRow=~data[a].table.hidden.rows.indexOf(rowID);if(isHiddenRow){return true}if(rowColumn){rowColumn.classList.remove("hidden")}});data[a].table.hidden.columns.splice(hiddenIndex,1)}else{rowsList.forEach(function(d){let rowColumn=d.querySelector(rowSelector);if(rowColumn){rowColumn.classList.add("hidden")}});data[a].table.hidden.columns.push(columnID)}}else{if(target.matches(".table-hide-row")){let rowID=target.parentNode.parentNode.getAttribute("data-row");let hiddenIndex;let isHidden=~(hiddenIndex=data[a].table.hidden.rows.indexOf(rowID));let row=table.querySelector('[data-row="'+rowID+'"]');if(isHidden){let columnsList=row.querySelectorAll("[data-column]");row.children[0].classList.remove("hidden");columnsList.forEach(function(d){let columnID=d.getAttribute("data-column");let isHiddenColumn=~data[a].table.hidden.columns.indexOf(columnID);if(isHiddenColumn){return true}d.classList.remove("hidden")});data[a].table.hidden.rows.splice(hiddenIndex,1)}else{Array.from(row.children).forEach(function(d){d.classList.add("hidden")});data[a].table.hidden.rows.push(rowID)}}else{if(target.matches(".table-new-column")){let columnID=target.parentNode.getAttribute("data-column");current.addColumn(table,a,columnID)}else{if(target.matches(".table-delete-column")){let columnID=target.parentNode.getAttribute("data-column");let rowsList=Array.from(table.querySelectorAll("tr"));let columnCells=table.querySelectorAll('[data-column="'+columnID+'"');let rowID=rowsList[1].getAttribute("data-row");let headerIdentifier=columnID+"."+rowID;Array.from(columnCells).forEach(function(d,e){rowsList[e].removeChild(d)});--data[a].dimensions[0];delete data[a].table.header[headerIdentifier];let hiddenIndex=data[a].table.hidden.columns.indexOf(columnID);if(~hiddenIndex){data[a].table.hidden.columns.splice(hiddenIndex,1)}let orderIndex=data[a].table.order.columns.indexOf(parseInt(columnID));if(~orderIndex){data[a].table.order.columns.splice(orderIndex,1)}Object.keys(data[a].table.rows).forEach(function(d){delete data[a].table.rows[d][columnID]})}else{if(target.matches(".table-new-row")){let eventRow=target.parentNode.parentNode;current.addRow(table,a,eventRow)}else{if(target.matches(".table-delete-row")){let parent=target.parentNode.parentNode;let rowID=parent.getAttribute("data-row");let columnID=parent.children[1].getAttribute("data-column");let headerIdentifier=columnID+"."+rowID;let hiddenIndex=data[a].table.hidden.rows.indexOf(rowID.toString());let orderIndex=data[a].table.order.rows.indexOf(parseInt(rowID));if(~hiddenIndex){data[a].table.hidden.rows.splice(hiddenIndex,1)}if(~orderIndex){data[a].table.order.rows.splice(orderIndex,1)}delete data[a].table.rows[rowID];delete data[a].table.header[headerIdentifier];--data[a].dimensions[1];parent.parentNode.removeChild(parent)}}}}}}}},{event:"click",element:addRowElement,content:function(){current.addRow(table,a)}},{event:"input",element:table,content:function(c){let target=c.target;if(target.matches("th[contenteditable]")){let columnID=target.getAttribute("data-column");let rowID=target.parentNode.getAttribute("data-row");let headerIdentifier=columnID+"."+rowID;data[a].table.header[headerIdentifier]=target.innerText.trim()}else{if(target.matches("td[contenteditable]")){let columnID=target.getAttribute("data-column");let rowID=target.parentNode.getAttribute("data-row");data[a].table.rows[rowID][columnID]=target.innerText.trim()}}}}]);let emptyClone=clones.emptyCell.cloneNode(true);emptyClone.classList.add("table-aside-action");actionRow.appendChild(emptyClone);actionRow.appendChild(clones.headerActionFirst.cloneNode(true));data[a].table.order.columns.push(firstColumnID);actionRow.children[1].setAttribute("data-column",firstColumnID.toString());headerRow.appendChild(clones.asideActionFirst.cloneNode(true));headerRow.appendChild(clones.headerCell.cloneNode(true));data[a].table.rows[firstRowID]={};data[a].table.order.rows.push(firstRowID);headerRow.setAttribute("data-row",firstRowID.toString());headerRow.children[1].setAttribute("data-column",firstColumnID.toString());table.appendChild(actionRow);table.appendChild(headerRow);for(let i=0;i<4;++i){current.addRow(table,a)}for(let i=0;i<3;++i){current.addColumn(table,a)}contentElement.appendChild(table)}};