componentsModule.modules.table={data:{},template:false,clones:{clone:false,headerActionCellFirst:false,headerActionCell:false,emptyCell:false,asideActionCellFirst:false,asideActionCell:false,headerCell:false,contentCell:false},validate:function(){return true},serialize:function(){return componentsModule.modules.table.data},resumeInline:function(b,c,a){componentsModule.modules.table.create(b,c,a)},addRow:function(b,a,c){let clone=componentsModule.modules.table.template;let tableRow=clone.querySelector(".table-row").cloneNode(true);let actionCell=componentsModule.modules.table.clones.asideActionCell.cloneNode(true);tableRow.appendChild(actionCell);let columnID=componentsModule.modules.table.data[a].table.order.columns[0];let headerCell=componentsModule.modules.table.clones.headerCell.cloneNode(true);headerCell.setAttribute("data-column",componentsModule.modules.table.data[a].table.order.columns[0]);tableRow.appendChild(headerCell);let rowID=Math.random()*(9999999-1000000)+1000000;componentsModule.modules.table.data[a].table.rows[rowID]={};tableRow.setAttribute("data-row",rowID);if(c===undefined){componentsModule.modules.table.data[a].table.order.rows.push(rowID)}else{let beforeID=parseFloat(c.getAttribute("data-row"));let beforeIndex=componentsModule.modules.table.data[a].table.order.rows.indexOf(beforeID);if(beforeIndex===-1){return false}componentsModule.modules.table.data[a].table.order.rows.splice(beforeIndex,0,rowID)}tableRow.setAttribute("data-row",rowID);if(componentsModule.modules.table.data[a].table.hidden.columns.indexOf(columnID)!==-1){headerCell.classList.add("hidden")}for(let i=0;i<componentsModule.modules.table.data[a].dimensions[0];++i){let contentCell=componentsModule.modules.table.clones.contentCell.cloneNode(true);let columnID=componentsModule.modules.table.data[a].table.order.columns[+i+1];contentCell.setAttribute("data-column",columnID);componentsModule.initializeEvents([{event:"change keyup",element:contentCell,content:function(d){componentsModule.modules.table.data[a].table.rows[rowID][columnID]=d.target.innerText.trim()}}]);tableRow.appendChild(contentCell)}componentsModule.initializeEvents([{event:"change keyup",element:headerCell,content:function(d){componentsModule.modules.table.data[a].table.header[rowID]=d.target.innerText.trim()}},{event:"click",element:actionCell.querySelector(".table-hide-row"),content:function(){let index=componentsModule.modules.table.data[a].table.hidden.rows.indexOf(rowID);let isHidden=(index!==-1);let cells=this.parentNode.parentNode.children;let length=cells.length;for(let i=0;i<length;++i){if(isHidden){cells[i].classList.remove("hidden")}else{cells[i].classList.add("hidden")}}if(isHidden){componentsModule.modules.table.data[a].table.hidden.rows.splice(index,1)}else{componentsModule.modules.table.data[a].table.hidden.rows.push(rowID)}}},{event:"click",element:actionCell.querySelector(".table-delete-row"),content:function(){this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);delete componentsModule.modules.table.data[a].table.rows[rowID];--componentsModule.modules.table.data[a].dimensions[1];delete componentsModule.modules.table.data[a].table.header[rowID];let hiddenIndex=componentsModule.modules.table.data[a].table.hidden.rows.indexOf(rowID);if(hiddenIndex!==-1){componentsModule.modules.table.data[a].table.hidden.rows.splice(hiddenIndex,1)}}},{event:"click",element:actionCell.querySelector(".table-new-row"),content:function(){componentsModule.modules.table.addRow(b,a,tableRow)}}]);if(!c){b.appendChild(tableRow)}else{b.insertBefore(tableRow,c)}++componentsModule.modules.table.data[a].dimensions[1];return b},addColumn:function(c,b,a){let columnID=Math.random()*(999999-100000)+100000;if(a){let afterIndex=componentsModule.modules.table.data[b].table.order.columns.indexOf(parseFloat(a));componentsModule.modules.table.data[b].table.order.columns.splice(afterIndex-1,0,columnID)}else{componentsModule.modules.table.data[b].table.order.columns.push(columnID)}let actionRow=c.querySelector(".table-action-row");let actionCell=componentsModule.modules.table.clones.headerActionCell.cloneNode(true);actionCell.setAttribute("data-column",columnID.toString());actionCell.querySelector(".table-hide-column").addEventListener("click",function(){this.parentNode.classList.toggle("hidden");let status=componentsModule.modules.table.data[b].table.hidden.columns.indexOf(columnID);if(status!==-1){componentsModule.modules.table.data[b].table.hidden.columns.splice(status,1)}else{componentsModule.modules.table.data[b].table.hidden.columns.push(columnID)}c.querySelectorAll("tr.table-row, tr.table-header-row").forEach(function(e){if(e.querySelector('[data-column="'+columnID+'"]')){e.querySelector('[data-column="'+columnID+'"]').classList.toggle("hidden")}})});actionCell.querySelector(".table-delete-column").addEventListener("click",function(e){e.target.parentNode.parentNode.parentNode.querySelectorAll("tr.table-row, tr.table-header-row").forEach(function(f){let cell=f.querySelector('td[data-column="'+columnID+'"], th[data-column="'+columnID+'"]');f.removeChild(cell)});e.target.parentNode.parentNode.removeChild(e.target.parentNode);--componentsModule.modules.table.data[b].dimensions[0];delete componentsModule.modules.table.data[b].table.header[columnID];let hiddenIndex=componentsModule.modules.table.data[b].table.hidden.columns.indexOf(columnID);if(hiddenIndex!==-1){componentsModule.modules.table.data[b].table.hidden.columns.splice(hiddenIndex,1)}let orderIndex=componentsModule.modules.table.data[b].table.order.columns.indexOf(columnID);if(orderIndex!==-1){componentsModule.modules.table.data[b].table.order.columns.splice(orderIndex,1)}for(let rowID in componentsModule.modules.table.data[b].table.rows){delete componentsModule.modules.table.data[b].table.rows[rowID][columnID]}});actionCell.querySelector(".table-new-column").addEventListener("click",function(){componentsModule.modules.table.addColumn(c,b,columnID)});let headerRow=c.querySelector(".table-header-row");let headerCell=componentsModule.modules.table.clones.headerCell.cloneNode(true);headerCell.setAttribute("data-column",columnID.toString());let contentRows=c.querySelectorAll(".table-row");let contentCell=componentsModule.modules.table.clones.contentCell.cloneNode(true);contentCell.setAttribute("data-column",columnID.toString());componentsModule.initializeEvents([{event:"change keyup",element:headerCell,content:function(e){componentsModule.modules.table.data[b].table.header[columnID]=e.target.innerText.trim()}}]);function d(e,f,g){componentsModule.initializeEvents([{event:"change keyup",element:g,content:function(h){componentsModule.modules.table.data[e].table.rows[f][columnID]=h.target.innerText.trim()}}])}if(!a){actionRow.appendChild(actionCell);headerRow.appendChild(headerCell);contentRows.forEach(function(e){let clone=contentCell.cloneNode(true);let rowID=parseFloat(e.getAttribute("data-row"));e.appendChild(clone);d(b,rowID,clone)})}else{let afterAction=actionRow.querySelector('[data-column="'+a+'"]');let afterHeader=headerRow.querySelector('[data-column="'+a+'"]');if(!afterAction||!afterHeader||!afterAction.nextSibling||!afterHeader.nextSibling){componentsModule.modules.table.addColumn(c,b);return false}actionRow.insertBefore(actionCell,afterAction.nextSibling);headerRow.insertBefore(headerCell,afterHeader.nextSibling);let done=false;contentRows.forEach(function(e){if(done){return false}let afterCell=e.querySelector('[data-column="'+a+'"]');if(!afterCell||!afterCell.nextSibling){componentsModule.modules.table.addColumn(c,b);done=true;return false}let clone=contentCell.cloneNode(true);let rowID=parseFloat(e.getAttribute("data-row"));e.insertBefore(clone,afterCell.nextSibling);d(b,rowID,clone)})}++componentsModule.modules.table.data[b].dimensions[0];return c},create:function(b,c,a){let current=componentsModule.modules.table;let contentElement=c.querySelector("div.table-box");let nameInput=c.querySelector("input[name=component_inline_table_name]");componentsModule.initializeEvents([{event:"wheel",element:contentElement,content:function(d){this.scrollLeft-=-(d.deltaY*20);d.preventDefault()}}]);current.data[b]={title:"",table:{hidden:{columns:[],rows:[]},header:{},rows:{},name:"",order:{rows:[],columns:[]}},dimensions:[0,0],disabled:0};componentsModule.initializeEvents([{event:"change keyup",element:nameInput,content:function(d){current.data[b].table.name=d.target.value.trim()}}]);if(a&&a.table.name){nameInput.value=a.table.name.trim();triggerEvent(nameInput,"change")}let clone=current.template;if(!clone){current.template=clone=c.querySelector("#template_inline_table_components").cloneNode(true).children[0]}let table=document.createElement("table");let actionRow=clone.querySelector(".table-action-row").cloneNode(true);if(!current.clones.headerActionCellFirst){current.clones.headerActionCellFirst=clone.querySelector(".table-header-action-first").cloneNode(true)}if(!current.clones.headerActionCell){current.clones.headerActionCell=clone.querySelector(".table-header-action").cloneNode(true)}if(!current.clones.emptyCell){current.clones.emptyCell=document.createElement("td")}current.clones.emptyCell.classList.add("table-aside-action");actionRow.appendChild(current.clones.emptyCell.cloneNode(true));actionRow.appendChild(current.clones.headerActionCellFirst.cloneNode(true));let firstColumnID;if(a&&a.table.order.columns){firstColumnID=a.table.order.columns[0]}else{firstColumnID=Math.random()*(999999-100000)+100000}current.data[b].table.order.columns.push(firstColumnID);actionRow.children[1].setAttribute("data-column",firstColumnID.toString());actionRow.children[1].children[0].addEventListener("click",function(){this.parentNode.classList.toggle("hidden");let status=current.data[b].table.hidden.columns.indexOf(firstColumnID);if(status!==-1){current.data[b].table.hidden.columns.splice(status,1)}else{current.data[b].table.hidden.columns.push(firstColumnID)}table.querySelectorAll("tr.table-row, tr.table-header-row").forEach(function(d){if(d.querySelector('[data-column="'+firstColumnID+'"]')){d.querySelector('[data-column="'+firstColumnID+'"]').classList.toggle("hidden")}})});actionRow.querySelector(".table-new-column").addEventListener("click",function(){current.addColumn(table,b,firstColumnID)});let headerRow=clone.querySelector(".table-header-row").cloneNode(true);if(!current.clones.asideActionCellFirst){current.clones.asideActionCellFirst=clone.querySelector(".table-aside-action-first").cloneNode(true)}if(!current.clones.headerCell){current.clones.headerCell=clone.querySelector("th[contenteditable=true]").cloneNode(true)}let firstRowID;if(a&&a.table.order.columns){firstRowID=a.table.order.rows[0]}else{firstRowID=Math.random()*(9999999-1000000)+1000000}current.data[b].table.rows[firstRowID]={};current.data[b].table.order.rows.push(firstRowID);let headerCell=current.clones.headerCell.cloneNode(true);let actionCellFirst=current.clones.asideActionCellFirst.cloneNode(true);let actionCellFirst_hide=actionCellFirst.querySelector(".table-hide-row");headerRow.appendChild(actionCellFirst);headerRow.appendChild(headerCell);if(!current.clones.asideActionCell){current.clones.asideActionCell=clone.querySelector(".table-aside-action").cloneNode(true)}if(!current.clones.contentCell){current.clones.contentCell=clone.querySelector("td[contenteditable=true]").cloneNode(true)}headerRow.setAttribute("data-row",firstRowID);headerCell.setAttribute("data-column",firstColumnID);componentsModule.initializeEvents([{event:"change keyup",element:headerCell,content:function(d){current.data[b].table.header[firstColumnID]=d.target.innerText.trim()}},{event:"click",element:actionCellFirst_hide,content:function(){let index=current.data[b].table.hidden.rows.indexOf(firstRowID);let isHidden=(index!==-1);let cells=this.parentNode.parentNode.children;let length=cells.length;for(let i=0;i<length;++i){if(isHidden){cells[i].classList.remove("hidden")}else{cells[i].classList.add("hidden")}}if(isHidden){current.data[b].table.hidden.rows.splice(index,1)}else{current.data[b].table.hidden.rows.push(firstRowID)}}}]);if(a&&a.table.header[firstColumnID]){headerCell.innerText=a.table.header[firstColumnID].trim();triggerEvent(headerCell,"change")}table.appendChild(actionRow);table.appendChild(headerRow);if(a===undefined){for(let i=0;i<4;++i){table=current.addRow(table,b)}for(let i=0;i<3;++i){table=current.addColumn(table,b)}}else{for(let i=0;i<a.dimensions[1];++i){table=current.addRow(table,b)}for(let i=0;i<a.dimensions[0];++i){table=current.addColumn(table,b)}}contentElement.querySelector(".table-add-button").addEventListener("click",function(){table=current.addRow(table,b)});contentElement.appendChild(table)}};