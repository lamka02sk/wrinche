componentsModule.modules.table={data:{},template:false,clones:{clone:false,actionRow:false,headerRow:false,tableRow:false,headerActionFirst:false,headerAction:false,asideActionFirst:false,asideAction:false,headerCell:false,contentCell:false,emptyCell:false},resumeInline:function(b,c,a){let current=componentsModule.modules.table;current.create(b,c,a)},validate:function(){return true},serialize:function(){return componentsModule.modules.table.data},addRow:function(c,b,d,a){let current=componentsModule.modules.table;let clones=current.clones;let data=current.data[b];let tableRow=clones.tableRow.cloneNode(true);let actionCell=clones.asideAction.cloneNode(true);let columnID=data.table.order.columns[0];let headerCell=clones.headerCell.cloneNode(true);let rowID=Math.floor(Math.random()*(9999999-1000000))+1000000;tableRow.appendChild(actionCell);headerCell.setAttribute("data-column",data.table.order.columns[0]);tableRow.appendChild(headerCell);data.table.rows[rowID]={};tableRow.setAttribute("data-row",rowID);if(d===undefined){data.table.order.rows.push(rowID)}else{let beforeID=parseFloat(d.getAttribute("data-row"));let beforeIndex=data.table.order.rows.indexOf(beforeID);if(beforeIndex===-1){return false}data.table.order.rows.splice(beforeIndex,0,rowID)}if(data.table.hidden){if(data.table.hidden.columns.indexOf(columnID)!==-1){headerCell.classList.add("hidden")}}for(let i=0;i<data.dimensions[0];++i){let contentCell=clones.contentCell.cloneNode(true);let columnID=data.table.order.columns[+i+1];contentCell.setAttribute("data-column",columnID);tableRow.appendChild(contentCell)}if(!d){c.appendChild(tableRow)}else{c.insertBefore(tableRow,d)}if(a!==undefined){if(a.hidden){triggerEvent(actionCell.children[0],"click")}if(a.header){headerCell.innerText=a.header;triggerEvent(headerCell,"input")}}++data.dimensions[1];return c},addColumn:function(d,c,b,a){let current=componentsModule.modules.table;let data=current.data[c];let clones=current.clones;let columnID=Math.floor(Math.random()*(999999-100000))+100000;let actionRow=d.querySelector(".table-action-row");let actionCell=clones.headerAction.cloneNode(true);let headerRow=d.querySelector(".table-header-row");let headerCell=clones.headerCell.cloneNode(true);let contentRows=d.querySelectorAll(".table-row");let contentCell=clones.contentCell.cloneNode(true);if(b!==undefined){let afterIndex=data.table.order.columns.indexOf(parseInt(b));data.table.order.columns.splice(++afterIndex,0,columnID)}else{data.table.order.columns.push(columnID)}actionCell.setAttribute("data-column",columnID.toString());headerCell.setAttribute("data-column",columnID.toString());contentCell.setAttribute("data-column",columnID.toString());if(b===undefined){actionRow.appendChild(actionCell);headerRow.appendChild(headerCell);if(a!==undefined){if(a.header){headerCell.innerText=a.header;triggerEvent(headerCell,"input")}}contentRows.forEach(function(f,e){let currentCell=contentCell.cloneNode(true);f.appendChild(currentCell);if(a!==undefined){if(a.data[e]!==undefined){currentCell.innerText=a.data[e];triggerEvent(currentCell,"input")}let rowID=f.getAttribute("data-row");if(data.table.hidden){if(data.table.hidden.rows.indexOf(rowID)!==-1){currentCell.classList.add("hidden")}}}})}else{let afterAction=actionRow.querySelector('[data-column="'+b+'"]');let afterHeader=headerRow.querySelector('[data-column="'+b+'"]');let done=false;actionRow.insertBefore(actionCell,afterAction.nextSibling);headerRow.insertBefore(headerCell,afterHeader.nextSibling);contentRows.forEach(function(e){if(done){return false}let afterCell=e.querySelector('[data-column="'+b+'"]');let clone=contentCell.cloneNode(true);e.insertBefore(clone,afterCell.nextSibling)})}if(a!==undefined){if(a.hidden!==undefined){triggerEvent(actionCell.children[0],"click")}}++componentsModule.modules.table.data[c].dimensions[0];return d},allowHorizontalScrolling:function(a){componentsModule.initializeEvent({event:"wheel",element:a,content:function(b){this.scrollLeft-=-(b.deltaY*20);b.preventDefault()}})},createTemplateClones:function(a){let current=componentsModule.modules.table;let template=current.template;let clones=current.clones;if(template===false){current.template=template=a.querySelector("#template_inline_table_components").cloneNode(true).children[0]}if(clones.actionRow===false){clones.actionRow=template.querySelector(".table-action-row").cloneNode(true)}if(clones.headerActionFirst===false){clones.headerActionFirst=template.querySelector(".table-header-action-first").cloneNode(true)}if(clones.headerAction===false){clones.headerAction=template.querySelector(".table-header-action").cloneNode(true)}if(clones.emptyCell===false){clones.emptyCell=document.createElement("td")}if(clones.headerRow===false){clones.headerRow=template.querySelector(".table-header-row").cloneNode(true)}if(clones.asideActionFirst===false){clones.asideActionFirst=template.querySelector(".table-aside-action-first").cloneNode(true)}if(clones.headerCell===false){clones.headerCell=template.querySelector("th[contenteditable=true]").cloneNode(true)}if(clones.asideAction===false){clones.asideAction=template.querySelector(".table-aside-action").cloneNode(true)}if(clones.contentCell===false){clones.contentCell=template.querySelector("td[contenteditable=true]").cloneNode(true)}if(clones.tableRow===false){clones.tableRow=template.querySelector(".table-row").cloneNode(true)}},create:function(c,d,a){let current=componentsModule.modules.table;let contentElement=d.querySelector("div.table-box");let nameInput=d.querySelector("input[name=component_inline_table_name]");let clones=current.clones;let data=current.data;current.createTemplateClones(d);let table=document.createElement("table");let actionRow=clones.actionRow.cloneNode(true);let headerRow=clones.headerRow.cloneNode(true);let firstColumnID=Math.floor(Math.random()*(999999-100000))+100000;let firstRowID=Math.floor(Math.random()*(9999999-1000000))+1000000;let addRowElement=contentElement.querySelector(".table-add-button");current.allowHorizontalScrolling(contentElement);data[c]={title:"",table:{hidden:{columns:[],rows:[]},header:{},rows:{},name:"",order:{rows:[],columns:[]}},dimensions:[0,0],disabled:0};componentsModule.initializeEvents([{event:"input",element:nameInput,content:function(j){data[c].table.name=j.target.value.trim()}},{event:"click",element:table,content:function(j){let target=j.target;if(target.matches(".table-hide-column")){let e=target.parentNode.getAttribute("data-column");let hiddenIndex;let isHidden=~(hiddenIndex=data[c].table.hidden.columns.indexOf(e));let rowsList=table.querySelectorAll("tr");let rowSelector='[data-column="'+e+'"]';if(isHidden){rowsList.forEach(function(k){let f=k.getAttribute("data-row");let rowColumn=k.querySelector(rowSelector);let isHiddenRow=~data[c].table.hidden.rows.indexOf(f);if(isHiddenRow){return true}if(rowColumn){rowColumn.classList.remove("hidden")}});data[c].table.hidden.columns.splice(hiddenIndex,1)}else{rowsList.forEach(function(k){let rowColumn=k.querySelector(rowSelector);if(rowColumn){rowColumn.classList.add("hidden")}});data[c].table.hidden.columns.push(e)}}else{if(target.matches(".table-hide-row")){let f=target.parentNode.parentNode.getAttribute("data-row");let hiddenIndex;let isHidden=~(hiddenIndex=data[c].table.hidden.rows.indexOf(f));let row=table.querySelector('[data-row="'+f+'"]');if(isHidden){let columnsList=row.querySelectorAll("[data-column]");row.children[0].classList.remove("hidden");columnsList.forEach(function(k){let e=k.getAttribute("data-column");let isHiddenColumn=~data[c].table.hidden.columns.indexOf(e);if(isHiddenColumn){return true}k.classList.remove("hidden")});data[c].table.hidden.rows.splice(hiddenIndex,1)}else{Array.from(row.children).forEach(function(k){k.classList.add("hidden")});data[c].table.hidden.rows.push(f)}}else{if(target.matches(".table-new-column")){let e=target.parentNode.getAttribute("data-column");current.addColumn(table,c,e)}else{if(target.matches(".table-delete-column")){let e=target.parentNode.getAttribute("data-column");let rowsList=Array.from(table.querySelectorAll("tr"));let columnCells=table.querySelectorAll('[data-column="'+e+'"');let f=rowsList[1].getAttribute("data-row");let b=e+"."+f;Array.from(columnCells).forEach(function(k,l){rowsList[l].removeChild(k)});--data[c].dimensions[0];delete data[c].table.header[b];let hiddenIndex=data[c].table.hidden.columns.indexOf(e);if(~hiddenIndex){data[c].table.hidden.columns.splice(hiddenIndex,1)}let orderIndex=data[c].table.order.columns.indexOf(parseInt(e));if(~orderIndex){data[c].table.order.columns.splice(orderIndex,1)}Object.keys(data[c].table.rows).forEach(function(k){delete data[c].table.rows[k][e]})}else{if(target.matches(".table-new-row")){let eventRow=target.parentNode.parentNode;current.addRow(table,c,eventRow)}else{if(target.matches(".table-delete-row")){let parent=target.parentNode.parentNode;let f=parent.getAttribute("data-row");let e=parent.children[1].getAttribute("data-column");let b=e+"."+f;let hiddenIndex=data[c].table.hidden.rows.indexOf(f.toString());let orderIndex=data[c].table.order.rows.indexOf(parseInt(f));if(~hiddenIndex){data[c].table.hidden.rows.splice(hiddenIndex,1)}if(~orderIndex){data[c].table.order.rows.splice(orderIndex,1)}delete data[c].table.rows[f];delete data[c].table.header[b];--data[c].dimensions[1];parent.parentNode.removeChild(parent)}}}}}}}},{event:"click",element:addRowElement,content:function(){current.addRow(table,c)}},{event:"input",element:table,content:function(j){let target=j.target;if(target.matches("th[contenteditable]")){let e=target.getAttribute("data-column");let f=target.parentNode.getAttribute("data-row");let b=e+"."+f;data[c].table.header[b]=target.innerText.trim()}else{if(target.matches("td[contenteditable]")){let e=target.getAttribute("data-column");let f=target.parentNode.getAttribute("data-row");data[c].table.rows[f][e]=target.innerText.trim()}}}}]);let emptyClone=clones.emptyCell.cloneNode(true);emptyClone.classList.add("table-aside-action");actionRow.appendChild(emptyClone);actionRow.appendChild(clones.headerActionFirst.cloneNode(true));data[c].table.order.columns.push(firstColumnID);actionRow.children[1].setAttribute("data-column",firstColumnID.toString());headerRow.appendChild(clones.asideActionFirst.cloneNode(true));headerRow.appendChild(clones.headerCell.cloneNode(true));data[c].table.rows[firstRowID]={};data[c].table.order.rows.push(firstRowID);headerRow.setAttribute("data-row",firstRowID.toString());headerRow.children[1].setAttribute("data-column",firstColumnID.toString());table.appendChild(actionRow);table.appendChild(headerRow);if(a!==undefined){nameInput.value=a.table.name.trim();triggerEvent(nameInput,"input");const h=a.table.order.rows[0];const g=a.table.order.columns[0];const b=g+"."+h;if(a.table.header){headerRow.children[1].innerText=a.table.header[b];triggerEvent(headerRow.children[1],"input")}if(a.table.hidden){if(a.table.hidden.columns){if(a.table.hidden.columns.indexOf(g)!==-1){triggerEvent(actionRow.children[1].children[0],"click")}}if(a.table.hidden.rows){if(a.table.hidden.rows.indexOf(h)!==-1){triggerEvent(headerRow.children[0].children[0],"click")}}}for(let i=0;i<a.dimensions[1];++i){const f=a.table.order.rows[i+1];let headerID=g+"."+f;let rowData={};if(a.table.hidden){if(a.table.hidden.rows){rowData.hidden=a.table.hidden.rows.indexOf(f)!==-1}}if(a.table.header){rowData.header=a.table.header[headerID]}current.addRow(table,c,undefined,rowData)}for(let i=0;i<a.dimensions[0];++i){const e=a.table.order.columns[i+1];let headerID=e+"."+h;let columnData={};if(a.table.hidden){if(a.table.hidden.columns){columnData.hidden=a.table.hidden.columns.indexOf(e)!==-1}}if(a.table.header){columnData.header=a.table.header[headerID]}columnData.data=[];if(a.table.rows){a.table.order.rows.forEach(function(j){if(a.table.rows[j]===undefined){return false}if(a.table.rows[j][e]){columnData.data.push(a.table.rows[j][e])}})}current.addColumn(table,c,undefined,columnData)}}else{for(let i=0;i<4;++i){current.addRow(table,c)}for(let i=0;i<3;++i){current.addColumn(table,c)}}contentElement.appendChild(table)}};