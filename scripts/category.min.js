function CategoryComponents(){this.components=["title","url","description","parent","thumbnail","visibility"];this.title={start:function(){this.title.data.value=document.querySelector("input[name=new_category_name]").value.trim()}.bind(this),data:{value:""},validate:function(){return(this.title.data.value.length<101&&this.title.data.value.length>0)}.bind(this),serialize:function(){return this.title.data.value}.bind(this),events:[{event:"change keyup",element:document.querySelector("input[name=new_category_name]"),content:function(a){this.title.data.value=a.target.value.trim()}.bind(this)}]};this.url={start:function(){this.url.data.value=document.querySelector("input[name=new_category_url]").value.trim()}.bind(this),data:{value:""},validate:function(){if(this.url.data.value===""){return true}let url=(/^[a-z0-9][-a-z0-9]+[a-z0-9]$/.test(this.url.data.value));let len=(this.url.data.value.length<121&&this.url.data.value.length>2);return(url&&len)}.bind(this),serialize:function(){return this.url.data.value}.bind(this),events:[{event:"change keyup",element:document.querySelector("input[name=new_category_url]"),content:function(a){this.url.data.value=a.target.value.trim()}.bind(this)}]};this.description={start:function(){this.description.data.text=document.querySelector("textarea[name=new_category_description]").value.trim()}.bind(this),data:{text:""},validate:function(){return(this.description.data.text.length<200)}.bind(this),serialize:function(){return this.description.data.text}.bind(this),events:[{event:"change keyup",element:document.querySelector("textarea[name=new_category_description]"),content:function(a){this.description.data.text=a.target.value.trim()}.bind(this)}]};this.parent={start:function(){this.parent.data.value=document.querySelector("select[name=new_category_parent] option[selected]").getAttribute("value");new Selector({selector:"select[name=new_category_parent]",onSelect:function(b,a){this.parent.data.value=a.getAttribute("value")}.bind(this)})}.bind(this),data:{value:-1},validate:function(){return !(isNaN(this.parent.data.value))}.bind(this),serialize:function(){return this.parent.data.value}.bind(this)};this.thumbnail={start:function(){if(document.querySelector("div.header_image-image.category-image-instance")){this.thumbnail.data.path=document.querySelector("div.header_image-image.category-image-instance").getAttribute("data-path")}}.bind(this),data:{path:""},validate:function(){return true}.bind(this),serialize:function(){return this.thumbnail.data.path}.bind(this),addThumbnail:function(b,a){let parent=document.querySelector("label[for=category-thumbnail]").parentNode;if(parent.querySelector("div.header_image-image.category-image-instance")){parent.removeChild(parent.querySelector("div.header_image-image.category-image-instance"))}let source;if(!a){source="app/Data/Files/Images/"+b}else{source=b}let template=parent.querySelector("#template_new_category_thumbnail_image").children[0].cloneNode(true);template.setAttribute("data-path",b);template.classList.add("category-image-instance");template.children[0].setAttribute("src",source);template.children[0].setAttribute("alt",b);template.children[1].innerText=b;parent.appendChild(template);template.children[0].addEventListener("load",function(){parent.querySelector("div.input-box").classList.add("hide");$("div.media-manager span.close-manager").click();packery.packery().reloadItems()});document.querySelector("div.header_image-image.category-image-instance span.header_image-remove").addEventListener("click",function(){this.thumbnail.data.path="";let instance=parent.querySelector("div.category-image-instance");parent.querySelector("div.input-box").classList.remove("hide");parent.removeChild(instance);packery.packery().reloadItems()}.bind(this));this.thumbnail.data.path=source}.bind(this),events:[{event:"click",element:document.querySelector("label[for=category-thumbnail]").parentNode.querySelector("button.image_manager"),content:function(){managerActiveInstance=new MediaManager({onSelect:function(a){this.thumbnail.addThumbnail(a,false)}.bind(this)})}.bind(this)},{event:"change click keyup",element:document.querySelector("input[name=new_category_thumbnail_input]"),content:function(a){let input=a.target;let value=input.value;if(/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/.test(value)){showValidationResult(input,"",true,function(){packery.packery().reloadItems()});if(a.keyCode&&a.keyCode===13){let testImage=new Image;testImage.onload=function(){this.thumbnail.addThumbnail(value,true)}.bind(this);testImage.onerror=function(){showValidationResult(input,"VALIDATION_URL_UNRESOLVED",false,function(){packery.packery().reloadItems()})}.bind(this);testImage.src=value}}else{showValidationResult(input,"VALIDATION_URL_INVALID",false,function(){packery.packery().reloadItems()})}}.bind(this)}]};this.visibility={start:function(){this.visibility.data.value=!!(document.querySelector("input[name=new_category_visibility]").checked)}.bind(this),data:{value:true},validate:function(){return(typeof(this.visibility.data.value)==="boolean")}.bind(this),serialize:function(){return this.visibility.data.value}.bind(this),events:[{event:"change",element:document.querySelector("input[name=new_category_visibility]"),content:function(a){this.visibility.data.value=!!(a.target.checked)}.bind(this)}]};initializeComponentEvents(this);this.validate=function(){for(let i=0;i<this.components.length;++i){if(!this[this.components[i]].validate()){return false}}return true}.bind(this);this.serialize=function(){let messageElement=document.querySelector("div.action-bar span.result-message");if(!this.validate()){translate.addTranslation("validate");messageElement.classList.remove("success");messageElement.classList.add("error");messageElement.setAttribute("data-locale","EMPTY_INPUT");messageElement.innerText=translate.locale.validate.EMPTY_INPUT;return false}else{messageElement.classList.remove("success");messageElement.classList.remove("error");messageElement.setAttribute("data-locale","LOADING");messageElement.innerText=translate.locale.response.LOADING}let resultArray={};for(let i=0;i<this.components.length;++i){resultArray[this.components[i]]=this[this.components[i]].serialize()}return resultArray}.bind(this)}function initializeComponentEvents(a){for(let i=0;i<a.components.length;++i){if(!(a.components[i] in a)){continue}if(a[a.components[i]].start){a[a.components[i]].start()}if(!a[a.components[i]]["events"]){continue}for(let j=0;j<a[a.components[i]]["events"].length;++j){let eventTemplate=a[a.components[i]]["events"][j];let eventList=eventTemplate.event.trim().split(" ");if(eventTemplate.element[0]!==undefined){for(let k=0;k<eventTemplate.element.length;++k){let element=eventTemplate.element[k];for(let l=0;l<eventList.length;++l){element.addEventListener(eventList[l],eventTemplate.content)}}}else{for(let k=0;k<eventList.length;++k){eventTemplate.element.addEventListener(eventList[k],eventTemplate.content)}}}}}previousScripts.push("edit");$("div.counter").each(function(){let maxLen=+$(this).attr("data-maxLength");let current=$(this);let type=$(this).attr("data-input");if(type==="input"){let element=$(this).parent().find("input");let len=element.val().length;$(this).text(maxLen-len);element.on("change keyup click focusin",function(){let left=maxLen-element.val().trim().length;if(left<0){current.addClass("minus")}else{if(current.hasClass("minus")){current.removeClass("minus")}}current.text(left)})}else{let element=$(this).parent().find("textarea");let len=element.val().length;$(this).text(maxLen-len);element.on("change keyup click focusin",function(){let left=maxLen-element.val().trim().length;if(left<0){current.addClass("minus")}else{if(current.hasClass("minus")){current.removeClass("minus")}}current.text(left)})}});components=new CategoryComponents();document.querySelector("button.action-button.save-button").addEventListener("click",function(){let data=components.serialize();let messageElement=document.querySelector("div.action-bar span.result-message");if(data===false){return false}postData(URI+"category",data,function(a,b){if(b==="error"){messageElement.classList.remove("success");messageElement.classList.add("error");messageElement.setAttribute("data-locale","CONNECTION_ERROR");messageElement.innerText=translate.locale.response.CONNECTION_ERROR}else{a=JSON.parse(a);if(a.success){messageElement.classList.add("success");messageElement.classList.remove("error");messageElement.setAttribute("data-locale","NEW_CREATED_SUCCESS");messageElement.innerText=translate.locale.admin_new.NEW_CREATED_SUCCESS;setTimeout(function(){window.history.back()},1000)}else{messageElement.classList.remove("success");messageElement.classList.add("error");if(a.code){messageElement.setAttribute("data-locale",a.code);messageElement.innerText=translate.locale.response[a.code]}else{messageElement.setAttribute("data-locale","NEW_CREATED_ERROR");messageElement.innerText=translate.locale.admin_new.NEW_CREATED_ERROR}}}responseBox.classList.remove("loading");responseBox.classList.remove("open");responseBox.querySelector("span.message-content").innerHTML=""})});packery=$("div.content-content").packery({itemSelector:"div.settings-component",gutter:22});$("div.splash").addClass("done");